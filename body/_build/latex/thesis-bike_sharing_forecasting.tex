%% Generated by Sphinx.
\def\sphinxdocclass{jupyterBook}
\documentclass[letterpaper,10pt,english]{jupyterBook}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}
%% turn off hyperref patch of \index as sphinx.xdy xindy module takes care of
%% suitable \hyperpage mark-up, working around hyperref-xindy incompatibility
\PassOptionsToPackage{hyperindex=false}{hyperref}
%% memoir class requires extra handling
\makeatletter\@ifclassloaded{memoir}
{\ifdefined\memhyperindexfalse\memhyperindexfalse\fi}{}\makeatother

\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily,\sffamily,\ttfamily]{}
\usepackage{amsmath,amssymb,amstext}
\usepackage{polyglossia}
\setmainlanguage{english}



\setmainfont{FreeSerif}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Italic,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldItalic
]
\setsansfont{FreeSans}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]
\setmonofont{FreeMono}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]



\usepackage[Bjarne]{fncychap}
\usepackage[,numfigreset=1,mathnumfig]{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}



        % Start of preamble defined in sphinx-jupyterbook-latex %
         \usepackage[Latin,Greek]{ucharclasses}
        \usepackage{unicode-math}
        % fixing title of the toc
        \addto\captionsenglish{\renewcommand{\contentsname}{Contents}}
        \hypersetup{
            pdfencoding=auto,
            psdextra
        }
        % End of preamble defined in sphinx-jupyterbook-latex %
        

\title{A Comparison of Forecasting Techniques in Bike Sharing Services}
\date{Nov 14, 2021}
\release{}
\author{Luca Baggi}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{frontmatter::doc}}


\sphinxAtStartPar
Insert catchphrase


\chapter{Introduction}
\label{\detokenize{01-introduction:introduction}}\label{\detokenize{01-introduction::doc}}

\section{COVID\sphinxhyphen{}19 Effects and Mobility Habits in Italy}
\label{\detokenize{01-introduction:covid-19-effects-and-mobility-habits-in-italy}}
\sphinxAtStartPar
The COVID\sphinxhyphen{}19 pandemic set the world back in its pursuit of the seventeen Sustainable Development Goals (SDGs) (The 17 Goals, n.d.). This is also the case for Italy, as we can see from the 92 statistical measures collected by the Italian national institute for statistics (ISTAT, Istituto Nazionale di Statistica). When comparing 2019 with data from ten years prior, sixty percent of the measurements register an improvement, while twenty percent do not change and the remainder worsens. However, when comparing 2019 and 2020, only forty percent of the measurements improve, and almost the same amount displays a statistically significant drop (Dall’andamento degli obiettivi di sviluppo sostenibile alla mobilità, 2021).

\sphinxAtStartPar
To say that the pandemic brought about a lot of change would be a redundant understatement. Coming out of 2020, the Italian outlook is worse than the average of the (Western) European countries \sphinxhyphen{} as one can notice upon looking at macroeconomic variables such as the Gross Domestic Product (GDP). Part of the negative consequences could be offset, thanks to the government’s stimulus packages, the European Union’s (EU) funds and the European Central Bank’s (ECB) Pandemic Emergency Purchase Program, or PEPP \sphinxhyphen{} a massive asset purchase program of 1,850 billion euros. From the beginning, it was clear that the pandemic would accelerate digitalisation (Härmand, 2021) \sphinxhyphen{} and, indeed, it has: see (Anthony Jnr \& Abbas Petersen, 2021) for a meta\sphinxhyphen{}review or (Truant et al., 2021) for Italy. The generalised lockdowns reduced the greenhouse gases (GHG) emissions (see (Jephcote et al., 2021), (Singh \& Chauhan, 2020), (Lian et al., 2020) and (Gualtieri et al., 2020)) but only temporarily and relatively to the severity of the restrictions put in place: the pandemic altered electricity consumption habits, but in countries like Sweden “the consumption even increased” compared to 2019 (Bahmanyar et al., 2020). Besides, this also came at the expense of our transportation habits and the mobility sector in general.

\sphinxAtStartPar
According to ISTAT, private cars are now used for half of all travels, up from 44 percent in the pre\sphinxhyphen{}pandemic period. Furthermore, the so\sphinxhyphen{}called “mobilità dolce” (the Italian translation of micro\sphinxhyphen{}mobility) “does not seem to take off” (Dall’andamento degli obiettivi di sviluppo sostenibile alla mobilità, 2021). In 2020, 30 percent of interviewed families stated that they had “some or a lot of difficulties in connecting with public transportation in the area where they live” \sphinxhyphen{} an improvement from the 33 percent of the previous year. However, it is enough to look at the regional level to realise that improvements are not spread evenly, and some areas of the country are actually worse off with respect to 2019. There is a great deal of heterogeneity: the share of families with troubles in accessing public transportation services is lower in the North (26 percent) compared to the South (36 percent), while in Campania more than half of the families are affected (51 percent). Furthermore, only 27 percent of students reach the places where they study with public means of transportation (and it’s declining), while 75 percent reach the workplace with private means only (and the share is increasing) (Dall’andamento degli obiettivi di sviluppo sostenibile alla mobilità, 2021).

\sphinxAtStartPar
The only measurement that has been improving throughout the decade is that of air quality. However, these values remain significantly higher than the guidelines from the World Health Organisation (WHO) (Dall’andamento degli obiettivi di sviluppo sostenibile alla mobilità, 2021). Besides, on September 22, 2021 the WHO revised downwards their recommendations on air pollutants (the latest update dated back to 2005), and the European Commission (EC) declared that it will take this update into account when revising the guidelines for the upcoming year (Standards \sphinxhyphen{} Air Quality \sphinxhyphen{} Environment \sphinxhyphen{} European Commission, n.d.). Italy has always struggled to respect the European Directive on air pollution: on November 2020, the European Court of Justice (ECJ) judged that, from 2008 to 2017, Italy “systematically and continuously” violated the standards set by the Directive and failed in enacting countermeasures to avoid it (“Che Aria Respiriamo,” 2021). On July 2021, the European Environmental Agency (EEA) ranked European cities according to the average level of \(PM_{2.5}\) in the two previous years: out of 323 cities, Cremona (Lombardy) was second to last, Brescia and Pavia (both in Lombardy) were 315th and 314th respectively, while Venezia (Veneto) was 311st, Bergamo 306th and Milano 303rd (all in Lombardy) (European City Air Quality Viewer — European Environment Agency, 2021). Air pollution caused more than \sphinxstyleemphasis{52 thousands} premature deaths: almost 14 percent of the total premature death toll in Europe (Italy \sphinxhyphen{} Air Pollution Country Fact Sheet — European Environment Agency, 2020).

\sphinxAtStartPar
Unequal access to infrastructure (and, to a minor degree, air pollution) hinder the popularity of more sustainable mode of transport, such as biking and sharing services. The ISTAT report mentioned above estimated that in 2019 there were 30 million commuters in Italy (Gli spostamenti per motivi di studio o lavoro nel 2019 secondo il Censimento permanente della popolazione, 2021): more than two thirds (more than 20 million) need to reach their workplace, while the rest is made up of students (with a moderate variance: the share of students is higher in those regions where unemployment is higher, for example in Campania, where they make up 40\% of commuters). However, the report did not present any data on biking habits or the use of sharing services. These can only be found in an earlier report, published in 2019 and referring to two years prior.

\sphinxAtStartPar
The 2019 report mentions two interesting statistics about commuting habits: “almost one in five {[}commuters{]} choose an ‘active’ mode of transport” \sphinxhyphen{} that is, walking or biking. However, most of the “active” commuters are actually walking to work (17,4\%), whereas the bikers are only some 1,7\%. In general, it is women, young and more educated people who use more public transportation means and bicycles, while private vehicles (the exclusive means of commuting for more than 73 percent of the employed) are spread among men between 25 to 44 and with an average level of education (Spostamenti quotidiani e nuove forme di mobilità, 2019). Car pooling is chosen by some 12 percent of the employed and 14,5 percent of students aged 18\sphinxhyphen{}24, while only less than half a million used bike sharing services at least once during the year (i.e., less than 2 percent). Such services are more popular across the young and more educated people, while the incidence is almost double the national average in metropolitan cities (Spostamenti quotidiani e nuove forme di mobilità, 2019).


\section{Bike\sphinxhyphen{}Sharing Demand Determinants and the State of Public Transport Infrastructure in Italy}
\label{\detokenize{01-introduction:bike-sharing-demand-determinants-and-the-state-of-public-transport-infrastructure-in-italy}}
\sphinxAtStartPar
The picture drawn by the two ISTAT reports feels like a pool of untapped (if not wasted) potential. According to the most recent survey, in 2019 some 57,5\% percent of commuters moved within the same municipality of residence. This value is driven up by the students, who make up almost 71 percent of commuters within the same municipality. However, even after taking them out of the computation, we still end up with an even figure: more than 51 percent of workers move within the same municipality (Gli spostamenti per motivi di studio o lavoro nel 2019 secondo il Censimento permanente della popolazione, 2021).

\sphinxAtStartPar
Sure, it would be naive to argue that commuters who work in the same municipality where they live could all bike to reach their destinations: after all, there is a great deal of heterogeneity across municipalities under several dimensions \sphinxhyphen{} like their sheer extension, morphology and, of course, infrastructure. There are many factors that affect bike sharing demand: the first one that comes to mind are the weather conditions: precipitations, humidity and seasonal patterns; the one that arguably plays the biggest role is the so\sphinxhyphen{}called “built environment” (Eren \& Uz, 2020), i.e. infrastructure such as the availability of isolated or dedicated bike lanes instead of mixed ones, but also safe parking areas and bike racks for private bikes. The terrain clearly plays a role: slopes have a negative effect on bike usage (as one of the many examples, see (Bordagaray et al., 2016)), but incentive schemes can be devised to promote returning bikes to up\sphinxhyphen{}hill stations and even the least loaded ones (which also improves the overall efficiency of the system) (Fricker \& Gast, 2016). Furthermore, in this scenario there is a positive effect of e\sphinxhyphen{}bikes. Besides, the literature also outlines the role of land use: pick\sphinxhyphen{}ups are more frequent in commercial areas and parks, compared to residential ones and, more broadly “the proximity to green spaces and recreation areas, schools, universities, museums, shopping centers, sports areas, restaurants, hotels, bus/subway/train/suburban/ ferry transit hubs has a positive effect on the use of BSP {[}Bike Sharing Programs{]}” (Eren \& Uz, 2020).

\sphinxAtStartPar
The degree of integration with the public transportation is also important, as bike\sphinxhyphen{}sharing systems are found to be complementary means for “{[}bridging{]} the gap between multiple transit hubs” (Eren \& Uz, 2020). But bike sharing can also be a substitute “especially when public transport is not available, between 22:00 pm {[}and{]} 06:00 a.m., they can encourage users to use BSP” (Eren \& Uz, 2020). This implies that there is no single channel to promote bike\sphinxhyphen{}sharing services and that coordination across institutional players is crucial. Despite this, investments in bike\sphinxhyphen{}sharing services shall not fall in the background: their complementary role as “first/last mile solution” is recognised in the literature and enhance public transport as a whole.

\sphinxAtStartPar
Improving the public transport infrastructure is a priority for Italy. As always, there are territorial imbalances on two different dimensions: on the macro level, there is a clear divide between North and South, but there continue to be striking differences even within the wealthiest regions. Bike lanes have been increasing steadily: the total number of kilometres has grown by 15,5 percent since 2015, totalling approximately 4700 kilometres. However, the infrastructure is still far from adequate in most cities (Ambiente urbano, 2021).

\sphinxAtStartPar
The report from ISTAT outlines that public transport (or TPL, “trasporto pubblico locale”) suffers both from lack of infrastructure and outdated fleets. As a starter, the TPL is over reliant on buses, which offer more than 55 percent of the number of seats per kilometre. However, once metropolitan cities are factored out, this figure skyrockets to well beyond 90\sphinxhyphen{}95 percent (Ambiente urbano, 2021). Only 32 percent of the bus fleets is in line with Euro 6 standard and some 34 percent belongs to the Euro 4 class \sphinxhyphen{} i.e., was deployed before 2008. Low emission buses make up some 28 percent of the total, but only slightly more than 3 percent are electric: the rest (almost 25 percent) is fuelled by natural gas. Unsurprisingly, the share of low\sphinxhyphen{}emission vehicles is higher in metropolitan cities.

\sphinxAtStartPar
Trolley buses are available in only 13 municipalities, trams in 11 and metropolitan trains in 7. However, there is a remarkable divide between the Italian champion, Milan, and the other cities. Tram network density in Milan is measured as 122 km per 100 squared kilometres; the silver medal is awarded to Turin, which has almost half the kilometres than Milan: 66. The average of the other cities is a mere 16 km. In general, while the supply of TPL (measured in seats per kilometre, per inhabitant) is on the rise, we are still far from the levels before the Great Recession (\sphinxhyphen{}7,3 percent compared to 2008). However, the supply in the North is 25 percent greater compared to the Centre and almost three times bigger than the South. Public demand for TPL is increasing in the North, stationary in the Centre and even declining in the South.

\sphinxAtStartPar
A minor and uneven push is provided by sharing services. Car sharing is available in 37 out of 107 “comuni capoluogo” (i.e., the “capital” of a province, corresponding to the NUTS3 classification), of which only 8 are in the South. Besides, only 26 percent of the fleets is composed of electric cars. Bike sharing services are present in 53 \sphinxstyleemphasis{capoluoghi}, registering an overall decline from 2015. Luckily, the number of bikes has more than tripled: from 6 to 19 bicycles per ten thousand inhabitants. The divide, as always, is quite stark: the number of bikes is 29 in metropolis compared to provinces, and these services are much more common in the North (32 bikes per ten thousand citizens) than in the Centre (17) and the South (just 2). Much of this success is to be attributed to the appearance of free\sphinxhyphen{}float systems, which require greater fleets (Ambiente urbano, 2021). The report does not provide information on electric scooters.

\sphinxAtStartPar
Restructuring the public transport will require extensive coordination between national, regional and municipal administrations, across multiple channels simultaneously. It is a widespread hope that many of this results can (only) be achieved via the Next Generation EU (NGEU), the 750 billion euros stimulus that will be financed by bonds from the European Commission. The NGEU is a bold and unprecedented move from the EU: the fund will be made up with up to 390 billion euros in subsidies, while up to 360 billions will be given out as loans with low interest rates. Italy is the first beneficiary in absolute terms for the main facilities of the NGEU: the country will receive more than 190 billion euros, to which the government will add 30 billions of its own. According to the so\sphinxhyphen{}called PNRR (\sphinxstyleemphasis{Piano Nazionale di Recupero e Resilienza}, i.e. National Plan of Recovery and Resilience), almost 25 billion euros will be invested in railways. However, less than one billion will be used to improve on the regional railways \sphinxhyphen{} the Achilles’ heel of public transportation and the bane of commuters. In addition, more than 8,5 billion euros will be invested in TPL. But there’s a catch: the NGEU grants will only be available for projects to be completed within the year 2026. Interviewed by \sphinxstyleemphasis{Il Post}, prof. Gabriele Grea from Bocconi University stated that these funds will mostly be awarded to projects in an already “advanced state”: on one side, this will provide stronger guarantees about their completion, but will likely increase the inequalities across municipalities (Un po’ di cose notevoli dentro il PNRR, 2021).


\section{The Case for Promoting Bike Sharing}
\label{\detokenize{01-introduction:the-case-for-promoting-bike-sharing}}
\sphinxAtStartPar
Reforming the public transport will be crucial to reach carbon neutrality and possibly promote economic growth. After all, transport accounts for as much as 27 percent of emissions in the EU (Bergantino et al., 2021) and while the overall greenhouse gases (GHG) emissions has been declining since the 1990s, the emissions from road transportation has nonetheless been increasing ever since (Annual European Union Greenhouse Gas Inventory 1990–2018 and Inventory Report 2020 — European Environment Agency, 2020). Besides, it is well\sphinxhyphen{}known that Italy chose to privilege rubber over railways to transport goods: Eurostat estimated that from 2000 to 2016 less than 10 percent of goods travelled by train, while the EU average was almost 18 percent (Milano ha un’occasione storica, 2017), so there seems to be much room to increase productivity. And, besides, despite the fact that emissions have been decreasing since the 1990s, Italy is not on the side of the achievers: since 1990, emissions in the country were reduced by 17,2 percent, compared to the EU28’s 25,2 percent.

\sphinxAtStartPar
The Next Generation EU provides Italy with the perfect chance to narrow the divide with Western economies, while curbing emissions and finally improving the air quality. To promote more sustainable modes of transport, measures are needed on both the supply side (for example, by improving vehicle and fuel performance) and on the demand side by reducing demand for private transport, or at least increasing the demand for greener modes of transport (Bergantino et al., 2021). Investments in sharing services can and should play a role in this transition. Indeed, capital might be limited: after all, municipalities will receive a smaller share of the NGEU funds and upgrading their bus fleets seems more urgent. Besides, there are also the time constraints that need to be taken into account. However, biking infrastructure projects can be relatively cheaper compared to other TPL investments \sphinxhyphen{} especially if factoring in the presence of private entrepreneurs. Once infrastructure is in place, the costs of the service “only” amount to the human and technical cost to reallocate bikes to be at the right place at the right time.

\sphinxAtStartPar
This dissertation stems from the idea that bike sharing systems can be promoted with cheap measures. This is not a new approach to the literature: as an example, Cantelmo and his coauthors attempt to implement a low\sphinxhyphen{}dimensional model for bike\sphinxhyphen{}dharing demand forecasting that does not “focus on the methodological aspect of finding the most advanced algorithm to learn these correlations” (Cantelmo et al., 2020), as these more sophisticated models are prone to overfitting and new issues arise when more data is added to these models, i.e. when new contexts appear in the model space.

\sphinxAtStartPar
In particular, this project falls in the trunk of literature aimed at improving customer satisfaction through demand forecasting, a task of “tremendous commercial value” (Hamad et al., 2021). This task can be split in two categories: demand rebalancing and demand forecasting techniques. The first category, demand rebalancing or repositioning, simply means “design efficient bike repositioning solutions” (Ghosh et al., 2019). Rebalancing can either be user\sphinxhyphen{}based, when the users are offered an incentive to park the bike themselves, or operator\sphinxhyphen{}based. In this latter case, we can also distinguish between static rebalancing (when repositioning occurs when the service is off, like at night) and dynamic rebalancing otherwise (Cantelmo et al., 2020). The second problem, demand forecasting, is the one we will be focusing on. Simply put, demand forecasting attempt to estimate the number of bikes that will be requested at a certain moment in time. This task can be accomplished at the aggregate city level, or by identifying clusters of stations (the so\sphinxhyphen{}called Traffic\sphinxhyphen{}Analysis Zones or \sphinxstyleemphasis{TAZ}) or even at the individual station (Cantelmo et al., 2020).

\sphinxAtStartPar
These problems became ever more important since the introduction of free\sphinxhyphen{}float bike\sphinxhyphen{}sharing systems (FFBBS), as the bikes can be dropped anywhere and end up in sub\sphinxhyphen{}optimal places for the next customers. On the positive side, FFBBS do not require the upfront investments for building docking stations \sphinxhyphen{} which is necessary for station\sphinxhyphen{}based BSS (also known as SBSS). Furthermore, FFBSS “prevents bike theft”, “by tracking bikes in real\sphinxhyphen{}time with built\sphinxhyphen{}in GPS”, and “offers significant opportunities for smart management”(Pal \& Zhang, 2017). This implies a greater satisfaction level for customers, “because obtaining and returning the bikes becomes much more convenient” (Pal \& Zhang, 2017). However, all of this comes at the increased costs for bike rebalancing, because of how inefficient the redistribution becomes and the higher operating costs in terms of human and financial resources (Pal \& Zhang, 2017). This has been recognised as “one of the main reasons why many FFBS enterprises lose money or even withdrawn from market.”(Tian et al., 2021).

\sphinxAtStartPar
Most of the new approaches involve deep learning (DL) techniques, such as long\sphinxhyphen{}term short\sphinxhyphen{}memory (LSTM) neural networks, which usually outperform other statistical and machine learning approaches (Xu et al., 2018). Some are incredibly sophisticated: Convolutional LSTM are deep learning models “stacked and fused by multiple convolutional long short\sphinxhyphen{}term memory (LSTM) layers, standard LSTM layers, and convolutional layers {[}…{]} to better capture the spatio\sphinxhyphen{}temporal characteristics and correlations of explanatory variables” (Ke et al., 2017). In this instance, these models have been combined with external data such as “travel time rate, time\sphinxhyphen{}of\sphinxhyphen{}day, day\sphinxhyphen{}of\sphinxhyphen{}week, and weather conditions”, resulting in an improvement of error metrics (RMSE) by almost 50 percent (Ke et al., 2017).

\sphinxAtStartPar
There is no way we could best the performance of such sophisticated models. However, this may not be the ultimate goal for policymakers. Despite their impressive performances, deep learning methods are hard to implement. They require a considerable amount of resources and, unlike simpler models, are much more difficult to visualise and interpret. For one, they require senior data scientists and access to a local server cluster with access to Graphic Processing Units (GPUs) or cloud computing platforms such as Google Cloud, Microsoft Azure or Amazon Web Services. This infrastructure needs time to set up and delays are inevitable, since the data manipulated by public administration deserves a much greater degree of privacy. Besides, such models require a longer time to train \sphinxhyphen{} which translates to more expensive models.

\sphinxAtStartPar
Given the policymaker constraints, DL techniques may well be out of time, and budget. Our goal is to satisfy the constraints of a local planner with tight budget and more pressing issues, or the limited options of a private BSS company who needs to sustain high operational costs. We will develop two classes of models, univariate and multivariate, using both statistical and machine\sphinxhyphen{}learning methods. We will also attempt to evaluate the usefulness of external data \sphinxhyphen{} which might be hard to require and process \sphinxhyphen{} and the performances of libraries such as Facebook’s Prophet, which have been specifically designed for ‘forecasting at scale’, i.e. forecasting multiple time\sphinxhyphen{}series (in the order of the thousands) with little to no pre\sphinxhyphen{}processing, feature engineering and simple models.

\sphinxAtStartPar
This experiment has many drawbacks and limitations: as a starter, it does not include a proper spatial analysis, and does not explore Vector Auto Regressive (VAR) models, nor Bayesian models. Our goal is to prove that feature engineering and better data can do a better job at improving a model compared to more advanced techniques, especially under (hypothetically) tight budget constraints. In other words, we might want to get the feel for the marginally decreasing utility of accuracy improvements, which come at progressively greater computational costs.


\section{The Open Source Stack, Transparency and Reproducibility}
\label{\detokenize{01-introduction:the-open-source-stack-transparency-and-reproducibility}}
\sphinxAtStartPar
This is one of the many (millions?) projects to benefit from the existence of the open source community. This project was developed end\sphinxhyphen{}to\sphinxhyphen{}end using open source tools, starting from PostgreSQL to store the data and many Python libraries to train the models. Jupyter Notebooks have been the main developing tool (Perkel, 2018), and Jupyter Books (Executable Books Community, 2020) to convert the code into a \(\LaTeX\) publication, thanks to \sphinxcode{\sphinxupquote{pandoc}} working in the background (Pandoc \sphinxhyphen{} About Pandoc, n.d.).

\sphinxAtStartPar
Zotero was used as a bibliography manager (Zotero | Your Personal Research Assistant, n.d.), and merits are due to several extensions for JupyterLab that made writing on JupyterLab possible: in particular, \sphinxhref{https://github.com/krassowski/jupyterlab-citation-manager}{\sphinxcode{\sphinxupquote{jupyterlab\sphinxhyphen{}citation\sphinxhyphen{}manager}}} was used to insert citations inside notebooks via the official Zotero API, and \sphinxhref{https://github.com/jupyterlab-contrib/spellchecker}{\sphinxcode{\sphinxupquote{jupyterlab\_spellchecker}}} helped in spotting typographic mistakes. Of course, version control with \sphinxcode{\sphinxupquote{git}} and hosting on GitHub played a crucial role in project management. The code is free to see on the dedicated GitHub repository; however, data cannot be accessed due to the terms of the partnership between the provider and the University of Milan. We will try to find the space to introduce and contextualise all the other open source libraries that have been actively used.

\sphinxAtStartPar
There would be much to say about why using open source software, even (and especially) in economics. When it comes down to open source against proprietary software, the differences are not merely technical:
\begin{quote}

\sphinxAtStartPar
There is an independent social dimension, where the metrics assess the interactions between people. Does it increase trust? Does it increase the importance that people attach to a reputation for integrity?
\end{quote}

\sphinxAtStartPar
This is the Economics Nobel Prize Paul Romer (Romer, 2018), now 65, when comparing his experience with Jupyter and Mathematica notebooks. It goes on to make a bold claim:
\begin{quote}

\sphinxAtStartPar
Jupyter exemplifies the social systems that emerged from the Scientific Revolution and the Enlightenment, systems that make it possible for people to cooperate by committing to objective truth; Mathematica exemplifies the horde of new Vandals whose pursuit of private gain threatens a far greater pubic loss – the collapse of social systems that took centuries to build.
\end{quote}

\sphinxAtStartPar
When Romer tried to work with Mathematica notebooks and share their results, it became clear that “Wolfram made it hard to share a readable PDF version of a {[}Mathematica{]} notebook because it wanted someone like me to distribute content in its proprietary file format, the CDF”. The conclusion of his articles are quite dramatic:
\begin{quote}

\sphinxAtStartPar
The tie\sphinxhyphen{}breaker {[}between Wolfram and Jupyter, as well as proprietary and open source{]} is social, not technical. The more I learn about the open source community, the more I trust its members. The more I learn about proprietary software, the more I worry that objective truth might perish from the earth.
\end{quote}

\sphinxAtStartPar
Jupyter Notebooks are being developed since 2001 and they are ever more popular. Perhaps they might even replace the scientific paper (Somers, 2018); what’s sure is that they are ever more present. Indeed, Romer is not the only Nobel prize using open source software: Thomas Sargent, currently 78, uses Julia for his scientific research and launched a website, \sphinxhref{https://quantecon.org/}{QuantEcon} built with Jupyter Books, to teach computational economics in Python and Julia.


\chapter{Bike Sharing and BikeMi: A Literature Review}
\label{\detokenize{02-bikesharing_and_bikemi:bike-sharing-and-bikemi-a-literature-review}}\label{\detokenize{02-bikesharing_and_bikemi::doc}}

\section{A Brief History of Bike Sharing Services}
\label{\detokenize{02-bikesharing_and_bikemi:a-brief-history-of-bike-sharing-services}}
\sphinxAtStartPar
The concept behind bike sharing systems (BSS) has been around since at least the 1960 (DeMaio, 2009). Perhaps unsurprisingly, the first BSS operator was Dutch: it was called Witte Fietsen, or White Bikes, and was deployed in Amsterdam, 1965. The bikes for the sharing service were painted in white, in order to distinguish them from private bicycles, and were made freely available with no locks. Even less surprisingly, “the total absence of security mechanisms led to theft and vandalism, and a rapid demise of Witte Fietsen”, as pointed out by Fishman (Fishman, 2015).

\sphinxAtStartPar
Since this failed attempt, researchers have identified three further generations of bike sharing systems (Parkes et al., 2013), along the lines of their technological improvements. Being one of a kind, Witte Fietsen was basically the only representative of the first generations of bike sharing systems. According to DeMaio, the so\sphinxhyphen{}called second generation of bike sharing system was launched in the 1990s, in Denmark (1991 and 1993) and subsequently in the Netherlands (1995). These systems were designed with better insurances against frequent usage, as well as vandalism: “The Copenhagen bikes were specially designed for intense utilitarian use with solid rubber tires and wheels with advertising plates, and could be picked up and returned at specific locations throughout the central city with a coin deposit” (DeMaio, 2009). These incentives were not enough, as the time was not yet prime for better customer identification technologies as well as tracking systems.

\sphinxAtStartPar
New features such as “electronically\sphinxhyphen{}locking racks or bike locks, telecommunication systems, smart\sphinxhyphen{}cards, mobile phone access, and on\sphinxhyphen{}board computers” became the norm since 1996, following the example of services such as Bikeabout, developed by Portsmouth University in the United Kingdom (DeMaio, 2009). With Bikeabout, students could use a magnetic stripe card to rent a bike. Since then, a couple of third\sphinxhyphen{}generation bike sharing services launched every year across Europe, such as in France (Rennes, 1998) and Germany (Munich, 2000). These services managed to deter theft with “dedicated docking stations (in which bicycles are picked up and returned), as well as automated credit card payment and other technologies to allow the tracking of the bicycles” (Fishman, 2015). The peak of the third generation was reached around the second half of the 2000s, when Velo’v and its 1500\sphinxhyphen{}bike fleet were launched in Lyon in 2005, followed by the 7000 bikes deployed by Velib in 2007 in Paris.

\sphinxAtStartPar
Since then, bike\sphinxhyphen{}sharing spread to the rest of the world, and around the first half of the 2010s China established itself as a leader. In 2014, the global bike\sphinxhyphen{}sharing fleet was estimated at almost one million bicycles, three fourths of which where in China (Fishman, 2015); the country also had more than double the number of bike\sphinxhyphen{}sharing systems (237) compared to Italy (114) and Spain (113), while there were only 54 in the USA (Fishman, 2015). China is now the leader in sharing services, followed by Europe \sphinxhyphen{} which today still maintains its lead over the US, where “the adoption process it at an earlier stage and is gaining momentum” (Parkes et al., 2013).

\sphinxAtStartPar
This ongoing surge in popularity is once again due to technological breakthroughs: the fourth generation of bike sharing services exploits the Global Positioning System (GPS) and smartphones to deploy fleets of dock\sphinxhyphen{}less (or flee\sphinxhyphen{}floating) bikes and e\sphinxhyphen{}bikes. China could establish itself as leader also thanks to the rise of mobile technology and apps like WeChat, which was launched in 2011 and quickly became the most used platform in the country: “By the end of 2015, WeChat had 762 million monthly active users worldwide, and roughly 91\% of them were from China; moreover, around 639 million users accessed WeChat on a smartphone” CHEN 2017. WeChat is ubiquitous in China and living without it nigh impossible (“In Cina vivere senza WeChat è complicato,” 2018), as the platform supports cash transfers and is used for shopping, tipping and paying services.

\sphinxAtStartPar
These new technologies drastically lowered the entrance barriers and the otherwise high upfront investments to set up a bike sharing network. One of the most popular BSS, ofo, was born in 2014 thanks to a collective of students at China’s Peking University, who realised they could use the GPS on user’s phone to track the bikes. They chose the name “ofo” because word itself resembled a biker and brought together some 2000 bikes to use on\sphinxhyphen{}campus (Schmidt, 2018). The service was so popular that they quickly made it into a company.

\sphinxAtStartPar
According to Samantha Herr, executive director of the North American Bikeshare Association in Portland, Maine, “large\sphinxhyphen{}scale venture capital and cheaper equipment are the game changers that propelled the explosive growth of dockless companies like Mobike and ofo”. Dockless bikes are of “lower quality than their docked counterparts” and do not require expensive technologies to interface with a docking station: “That makes them cheaper to mass produce and drop off in new markets” (Schmidt, 2018). It is not by chance that most free\sphinxhyphen{}float BSS are completely private, while docked systems almost always feature a partnership between the private sector and local administrations.

\sphinxAtStartPar
Today, according to the estimates on the website \sphinxhref{https://bikesharingworldmap.com/}{Bike Sharing World Map}, there appear to be almost 1900 bike sharing services in the world, with almost 1000 that have closed down and 300 to be opened. According to an interview to Russell Meddin, the website founder, in 2018 there were 16 to 18 million free\sphinxhyphen{}float bikes, plus 3,7 million docked bikes.


\section{The Challenges of Sharing Services and the Sharing Economy}
\label{\detokenize{02-bikesharing_and_bikemi:the-challenges-of-sharing-services-and-the-sharing-economy}}
\sphinxAtStartPar
Sharing services are not without flaws. For example, Ma and their coauthors warn against some of the worse consequences of the sharing economy as a whole: “exploitative capitalism”, labour precarity, widening income gaps and “platform capitalism” (Ma et al., 2018). The researchers make a dramatic claim: “Left unaddressed, these trade\sphinxhyphen{}offs risk becoming crippling contradictions to the potential of the sharing economy in promoting urban transformations to sustainability” (Ma et al., 2018). This situation represents a great challenge for public administrations, as the pace of innovation is always much faster than policy\sphinxhyphen{}making, and regulating the more controversial aspects of a rapidly growing and popular platform is easier said than done.

\sphinxAtStartPar
Lawmaking takes years: as an example, the two “champions” of the sharing economy, Uber and AirBnB, were valued almost 70 and 30 billion dollars in 2017 (Stone, 2017), despite the press already outlining some of the most controversial aspects of their business models. Uber could never really get past the scandals (Goggin \& Taylor, 2019), especially those concerning the sexist culture of the company (Jackson, 2021), and this played a role in the weak IPO performance of the startup in 2019 (“Nel primo giorno di quotazione in borsa, le azioni di Uber hanno perso il 7,6 per cento,” 2019). In the meantime, other competitors were facing accusations about the legal status of their “riders”, and so did many other companies in the so\sphinxhyphen{}called gig economy, like Deliveroo (the renowned food delivery service). In countries such as Italy, this eventually led to the companies being ordered to recognise the employee status of the workers on the platform, further questioning not only the profitability but also the ethical basis of their business model (Secondo la procura di Milano, Uber Eats, Glovo, Deliveroo e Just Eat devono regolarizzare 60mila rider con contratti di collaborazione, 2021). Legal actions in Italy resulted in the company being placed under external management (Uber Italia è accusata di sfruttamento dei rider ed è stata commissariata, 2020), while in some US States, Uber and its primary competitor, Lyft, are now bound to observe a minimum wage (Seattle ha imposto una paga minima per gli autisti di Uber e Lyft, 2020).

\sphinxAtStartPar
However, these results only came several years later, and the same happened to AirBnB: despite a unexpectedly successful IPO (“La quotazione in borsa di Airbnb è stata un successo,” 2020) in the midst of the pandemic (“La crisi della sharing economy,” 2020), the company now also has to face tighter regulations that undermine their business model (“Airbnb Urges Housing Reform in Berlin after Court Overturns Permit Rejection,” 2017) (“La nuova sentenza europea sugli affitti brevi,” 2020) (“Le città europee contro gli affitti brevi,” 2021).

\sphinxAtStartPar
To a lesser extent, this is a concern for bike\sphinxhyphen{}sharing services as well \sphinxhyphen{} in particular for dockless bike sharing systems, which have undergone an unforeseeable growth in the past five years. As Ma and their coauthors synthesise, the unregulated and unexpected growth of Mobike in Shangai results in hitting “a threshold of oversupply, under\sphinxhyphen{}distribution and user misbehaviour problems, which endanger{[}ed{]} the environmental and social sustainability of innovative urban mobility schemes” (Ma et al., 2018). They proceed to state that “{[}T{]}he social, political and infrastructural institutions in cities have not developed adequate capacities and norms to respond, absorb and adapt to changes brought by under\sphinxhyphen{}regulated commercial and technological forces embodied in the modern sharing economy” (Ma et al., 2018).

\sphinxAtStartPar
The growth of Mobike was so fast that it also “exacerbated problems of user misbehaviour such as theft, vandalism and illegal parking, undermining the sharing values and public space resources that FFBSs require to operate efficiently” (Ma et al., 2018). Besides, this triggered venture capital funds (VC), which flocked to bike\sphinxhyphen{}sharing startups, leading to more than 1,7 million new bikes flooding the streets of Shanghai: “The oversupply of shared bikes created a serious strain on public resources. Massive numbers of bikes were dumped in public spaces, exacerbating existing crowding and stress on the city’s roads and parking spaces” (Ma et al., 2018). The collaboration between private enterprises and public officers began to deteriorate: bikes were ordered to be removed, while new BSS startups “dropped their bikes without any notice in advance” \sphinxhyphen{} a strategy that was also used in other parts of the world. The authors claim that this “unintended tragedy of the commons” was due to “under\sphinxhyphen{}regulated FFBSs”, which had to put their private interests (profitability) first if they wanted to survive the competition (Ma et al., 2018).


\section{The Elephant on the Sidewalk: Electric Scooters}
\label{\detokenize{02-bikesharing_and_bikemi:the-elephant-on-the-sidewalk-electric-scooters}}
\sphinxAtStartPar
Nowadays, bike sharing systems contend roads (and sometimes even sidewalks) with new competitors: electric scooters, or moped, which have become surprisingly popular across the globe in recent years, displaying a stronger growth trend and adoption compared to BSS. The literature on the history of e\sphinxhyphen{}scooters services is still quite young, but authors generally trace the beginning of electric scooter systems (ESS) to 2017, specifically to the US (Yang et al., 2021). Scooters arrived in Europe, specifically in Brussels, during the summer of 2018 (Moreau et al., 2020).

\sphinxAtStartPar
E\sphinxhyphen{}scooters have since developed quite rapidly, even faster than dockless bike sharing services (Yang et al., 2021), and today it is estimated that they make up almost two thirds of the shared micromobility trips in the US, while almost one in four citizens in Paris tried one in 2019 (Yang et al., 2021). However, moped did not come without hassles. For one, “rented and privately\sphinxhyphen{}owned e\sphinxhyphen{}scooters suddenly became a conspicuous, controversial and disruptive presence in urban public space” (Tuncer et al., 2020). Besides, their road status is not quite clear, and legal frameworks are still not ready to adapt to include e\sphinxhyphen{}scooters, which “upset the normal order of traffic and public space” (Tuncer et al., 2020). While they are used at least as widely as bikes (if not more), they do not seem to belong to roads more than skateboards, not to mention sidewalks.

\sphinxAtStartPar
Their advantages are clear: being electric, they can travel longer distances with lesser effort. Besides, scooters are handier and more portable than bikes. There are some disadvantages, too: scooters are electric and thus require charging, which introduces another step in the reallocation procedure. Overall, this entails greater costs for the service providers: while manufacturing costs might be assumed to be equivalent, recharging the batteries and moving them to and from the charging station surely translates into higher operational costs (Zhu et al., 2020). Furthermore, some authors in the literature also find that scooters have a shorter life span and thus “at present, the use of e\sphinxhyphen{}scooters shows a higher impact than the transportation modes they replace” (Moreau et al., 2020). This calculation does not include “end\sphinxhyphen{}of\sphinxhyphen{}life treatment”, which could positively affect their “GWP” or “Global Warming Potential” (Moreau et al., 2020). The authors suggest a list of measures that could reduce their impact, which include increased cooperation with the public sector: “new electric charging stations that are installed in the city could also include charging devices for e\sphinxhyphen{}scooters”; however, the supplier should also provide incentives, for example “a financial incentive for the users to drop the e\sphinxhyphen{}scooter off at charging areas and plug them in” (Moreau et al., 2020).

\sphinxAtStartPar
However, the literature is still too young to coherently assess the impact of e\sphinxhyphen{}scooters and their relationship with existing sharing service and public transport network. For example, it would be deemed reasonable that e\sphinxhyphen{}scooters might provide a good alternative to private transportation, yet “several studies suggest that they are frequently used instead of walking” (Tuncer et al., 2020), as it was found by (Laa \& Leth, 2020), (Mitra \& Hess, 2021), (Nikiforiadis et al., 2021) and (Sanders et al., 2020). Some authors specifically found that “People travelling with bicycle or motorcycle were not attracted by e\sphinxhyphen{}scooters novelty” (Nikiforiadis et al., 2021) or that are more likely to be employed for recreational purposes, “potentially filling a niche” (Sanders et al., 2020). One interesting trend that e\sphinxhyphen{}scooters display is that, after trying the service, some users do buy a scooter of their own (Tuncer et al., 2020), and e\sphinxhyphen{}scooters owners are more likely to use them as a replacement for their private cars (Moreau et al., 2020).

\sphinxAtStartPar
In other words, borrowing from economic jargon, it is still not clear why and when e\sphinxhyphen{}scooters are to be considered substitutes or complements of traditional modes of transport, and the same goes for bike sharing. On the one hand, it seems clear that e\sphinxhyphen{}scooters (and bikes) do not consistently replace private vehicles and cars in particular. By the way, this reinforces the idea that in order to transition towards a greener economy, promoting sharing services must go hand in hand with investments in public transportation networks, as well as improving existing biking infrastructure (Laa \& Leth, 2020).

\sphinxAtStartPar
For one, it might be expected that adoption of e\sphinxhyphen{}scooters translates into a decline in bike rentals. These are the findings of Yang and their coauthors (Yang et al., 2021), who estimated that in Chicago weekly usage of bike sharing in e\sphinxhyphen{}scooter sharing operation area declined by slightly more than 10 percent. Specifically, the usage of bike\sphinxhyphen{}sharing service subscribers was down by 4 percent, while the drop across non\sphinxhyphen{}subscribers was as big as 34 percent (Yang et al., 2021). Indeed, this might reveal that subscribers choose bikes for endogenously different reasons \sphinxhyphen{} i.e., they might deem them better suited for commuting. After all, “bike sharing use during non\sphinxhyphen{}peak hours decreased but was not affected during peak hours” (Yang et al., 2021). The drop was more marked with short trips, for which bike usage was down by almost 11 percent \sphinxhyphen{} twice as much as the decline in medium\sphinxhyphen{}duration trips (5,5) but almost half as much as in short trips (20,5). In general, it seems that docked bikes are preferred for commuting (Reck \& Axhausen, 2021) (Reck et al., 2021).


\section{Sharing Services in Milan: BikeMi and its Competitors}
\label{\detokenize{02-bikesharing_and_bikemi:sharing-services-in-milan-bikemi-and-its-competitors}}
\sphinxAtStartPar
BikeMi was introduced in December 2008 in a partnership between the City of Milan and Clear Channel Italia, a subsidiary of a global media and advertising group. In 2015, pedal assisted bicycles were introduced. Now the service counts 325 stations with 5430 bikes: 4280 are “classic”, 1000 are e\sphinxhyphen{}bikes and 150 are “pedal\sphinxhyphen{}assisted” (i.e., electric) with a child seat (Who We Are \sphinxhyphen{} BikeMi, n.d.). Including private enterprises (fully free\sphinxhyphen{}float), there are a total of 15400 bikes up for sharing, of which 3500 are electric. Private companies were progressively introduced in 2017, after public procurement and a testing phase (Bike Sharing \sphinxhyphen{} Comune Di Milano, 2021).

\sphinxAtStartPar
Mobike was the first, in July 2017, deploying 4000 bikes across Milan and Florence (P.Sol, 2017). ofo joined around the same time and economic Newspaper \sphinxstyleemphasis{il Sole 24 ORE} reported that, by November 2017, MoBike had deployed 8000 bikes in Milan and 7000 more in the rest of Italy, while ofo had 4000 bikes (Magnani, 2017). This resulted in BikeMi losing some 5 percent of their subscribers. ClearChannel, the service provider, disclosed that in 2009 they had some 10700 subscribers, which became around six times as much by 2017. At the time, BikeMi was reported to have 4650 bikes, of which 1000 were electric (Magnani, 2017). Surprisingly, BikeMi was reporting a profit: 200 thousand euros. Operating costs amounted to 6 million euros, two of which were covered by subscriptions and the remainder by advertisement revenue (Magnani, 2017).

\sphinxAtStartPar
The article was also reporting rumours about a fusion between the two private operators, which were undergoing extensive losses and could not be seen reaching the profitability goals they set themselves for the following years. In 2018, ofo was already said to be close to failure, while Mobike was allegedly looking to sell their operations in Europe (Salvioli, 2018). Indeed, ofo failed in 2020, while the Italian Idri Bk (manager of Mobike fleets) bought the European branch of Mobike on November 2019. From the operation, the new sharing service Movi (now RideMovi) was born, after ofo had already withdrawn from the Italian and European market (Soldavini, 2019). Now in Milan there are three bike sharing services: BikeMi is the only docked one, with rentals services open from 7 a.m. to 1 a.m. and from 7 a.m. to 2 a.m. during summer, plus 24 hours on Fridays and Saturdays. The other two services, RideMovi and Lime, are free\sphinxhyphen{}floating and operating 24 hours a day (Bike Sharing \sphinxhyphen{} Comune Di Milano, 2021).

\sphinxAtStartPar
Electric\sphinxhyphen{}scooter sharing services arrived in Milan \sphinxhref{https://www.comune.milano.it/servizi/monopattini-in-sharing}{only on February 2020} (Monopattini in Sharing \sphinxhyphen{} Comune Di Milano, 2021), right before the first wave of the COVID\sphinxhyphen{}19 pandemic and following a one\sphinxhyphen{}year long public procurement. Each provider was allowed a fleet of 750 e\sphinxhyphen{}moped, for a total of 2250 vehicles and three providers. To face the mobility challenges of the pandemic, the cap was increased to 6000 and the number of providers was doubled.


\section{Competitors and Data in Our Analysis}
\label{\detokenize{02-bikesharing_and_bikemi:competitors-and-data-in-our-analysis}}
\sphinxAtStartPar
The history of BikeMi’s competitors has several implications for our analysis. While we will be discussing the data and the choices for our project in the next chapter, it is worth anticipating some points. For one, we can already rule out electric scooters and their effects, as they only appeared in 2020 \sphinxhyphen{} a year for which we would have BikeMi data. However, given the pandemic break out, we chose not to forecast rentals in that period of time.

\sphinxAtStartPar
The situation becomes more complicated when it comes to the other dockless bike\sphinxhyphen{}sharing services. For one, we could not obtain data from any of the other providers, which either failed or sold all their activities to other private enterprises. Not having data about dockless services forces us to change our data strategy, but the literature comes to help. As we have outlined above, several authors found that docked bike\sphinxhyphen{}sharing systems are mostly used for commuting and are less sensitive to the introduction of free\sphinxhyphen{}floating BSS. Since ClearChannel only registered a 5 percent decrease in subscriptions since the FFBSS introduction, we feel reassured when accepting that we will only be able to model FFBSS effects with a dummy variable. After all, in just a few months private operators introduced at least as many bikes as BikeMi had: 4000 for ofo and 4000 for Mobike, which became twice as many in less than six months after the launch of the service. Given these numbers, a decline of only 5 percent does not seem worrisome.

\sphinxAtStartPar
If we buy the “docked bikes services are less sensitive to dockless ones” assumption, i.e. that docked bikes are preferred for commuting, it can be enough to forecast the number of bikes during peak hours. In the next chapter, we will see that peak commuting hours perfectly overlap with peak BikeMi usage. Finally, there is a considerable data gap from July 2018 to the end of that year, which forced us to analyse data from 2015 to that date only. All in all, the instability and novelty of free\sphinxhyphen{}floating bike sharing services has likely dampened their usage growth. For all the reasons outlined so far, we concluded that the lack of ways to account for ofo and Mobike data would not hinder our forecasts significantly. Besides, adopting the policymaker perspective, it would be quite difficult to have your competitor’s data available.


\section{BikeMi: a Review of the Literature}
\label{\detokenize{02-bikesharing_and_bikemi:bikemi-a-review-of-the-literature}}
\sphinxAtStartPar
Saibene and Manzi (Saibene \& Manzi, 2015) analyse survey data to evaluate the level of satisfaction for “all the actors involved”: service management, city council and users. The area taken into consideration was inside the “Bastioni”, i.e. inside of the historic hispanic walls. This area coincides with the so\sphinxhyphen{}called “Area C”, where cars have restricted access since 2012 (and paid access since 2008 with the so\sphinxhyphen{}called “Ecopass”). Sorrentino, Manzi and Virili (Sorrentino et al., 2019) also investigate the “organisational identity” of Clear Channel Italia, the service provider, focusing on the normative and utilitarian dimensions that characterise a public service. In particular, they observe how the “publicness” and “privateness” of BikeMi interact and how public accountability and social impact interact with Clear Channel’s profitability goals.

\sphinxAtStartPar
Toro and his coauthors (Toro et al., 2020) perform a similar analysis with data from June 2015 to December 2018 \sphinxhyphen{} the same period we analyse. They find that the service is “extensively used for commuting to work\sphinxhyphen{}related activities” and that “only strong meteorological conditions can impact the use of the service” (Toro et al., 2020). Indeed, it seems reasonable to assume that commuters are more inelastic to moderately adverse weather, as light rain or cold. The authors also implement a clustering algorithm to analyse bike\sphinxhyphen{}sharing services patterns, a widespread step in the literature \sphinxhyphen{} especially for forecasting about dockless services. The goal of this strategy is to “identify temporal\sphinxhyphen{}spatial patterns for specific users’ typologies” (Toro et al., 2020). They dispose of 13,789,569 records for 3650 traditional bikes and 1150 electric bikes (150 with a child seat). The service operates from 7 a.m. to midnight.

\sphinxAtStartPar
The authors remove all records before the service working hours, as they might inadvertently capture “extraordinary schedules” or maintenance. They do the same for trips whose duration was shorter than a minute and “records whose arrival or departure did not match with the existing stations” (Toro et al., 2020). They identify two types of users, occasional and regular, according to the 75th percentile threshold, i.e. 36 trips, with findings consistent with the literature. Regular users use the service more during weekdays with two different peaks along the day, and occasional users during holidays and weekends, with larger activities at lunchtime and evening hours (Toro et al., 2020).

\sphinxAtStartPar
Through spatial analysis, the researchers confirm that traffic flows from the periphery to the city centre in the mornings and back in the evenings, with greater use in the proximity of train stations. These patterns are also captured by cluster analysis. Looking at the weather, the usage starts to decline “dramatically” only around the 20mm threshold. Also Croci and Rossi (Croci \& Rossi, 2014) find that their results are robust to “confounding factors such as weather conditions”. Their research establishes that “the presence of metro and train stations, universities, museums, cinema and restricted traffic areas in correspondence of bike sharing stations significantly increase use. On the other hand the presence of tram and bus stops and theatres does not and has an opposite influence” (Croci \& Rossi, 2014). Lastly, Cappozzo and their coauthors work on scrapped BikeMi data to classify stations to determine “the future \sphinxstyleemphasis{full}, \sphinxstyleemphasis{empty} or \sphinxstyleemphasis{not problematic}” state of each station (Cappozzo et al., n.d.).


\chapter{BikeMi Data}
\label{\detokenize{03-data_ingestion_and_spatial_operations:bikemi-data}}\label{\detokenize{03-data_ingestion_and_spatial_operations::doc}}

\section{Data Ingestion}
\label{\detokenize{03-data_ingestion_and_spatial_operations:data-ingestion}}
\sphinxAtStartPar
The data was made available thanks to a partnership established by Prof. Giancarlo Manzi of the University of Milan and Clear Channel Italia, the provider of the service. The data is comprised of all the individual trips performed by each client (\sphinxcode{\sphinxupquote{cliente\_anonimizzato}}). This includes the bike type (which can either be a regular bike or an electric bike), the bike identifier, the station of departure and arrival with the time, the duration of the trip \sphinxcode{\sphinxupquote{durata\_noleggio}} plus the total travel distance. We do not know how the total travel distance \sphinxcode{\sphinxupquote{distanza\_totale}} is computed. Here are a selection of fields for the first five rows of the source data (time features are rounded to the daily level to fit into the page):

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
    bici tipo\PYGZus{}bici  cliente\PYGZus{}anonimizzato giorno\PYGZus{}prelievo  \PYGZbs{}
0   8480      Bike                 47869      2015\PYGZhy{}07\PYGZhy{}01   
1   6190      Bike                 74372      2015\PYGZhy{}07\PYGZhy{}01   
2   6000      Bike                105372      2015\PYGZhy{}07\PYGZhy{}01   
3  10538     eBike                103840      2015\PYGZhy{}07\PYGZhy{}01   
4   1981      Bike                 57260      2015\PYGZhy{}07\PYGZhy{}01   

       nome\PYGZus{}stazione\PYGZus{}prelievo giorno\PYGZus{}restituzione nome\PYGZus{}stazione\PYGZus{}restituzione  
0  Arco della Pace 2 \PYGZhy{} Pagano          2015\PYGZhy{}07\PYGZhy{}01       Vercelli \PYGZhy{} Cherubini  
1                  XXV Aprile          2015\PYGZhy{}07\PYGZhy{}01                    Caiazzo  
2                 San Giorgio          2015\PYGZhy{}07\PYGZhy{}01                    Rosario  
3                  XXV Aprile          2015\PYGZhy{}07\PYGZhy{}01                    Caiazzo  
4                  XXV Aprile          2015\PYGZhy{}07\PYGZhy{}01              Sant\PYGZsq{}Ambrogio  
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
The data available ranges from the first of June, 2015, to the first of October, 2020, totalling to 15.842.891 observations. Data was made available in Excel spreadsheets, following the \sphinxhref{https://docs.microsoft.com/en-us/openspecs/office\_standards/ms-xlsx/f780b2d6-8252-4074-9fe3-5d7bc4830968}{Office Open XML SpreadsheetML File Format} (the \sphinxcode{\sphinxupquote{.xlsx}} file format). Python”s Pandas library has methods to read \sphinxcode{\sphinxupquote{.xlsx}} files; however, given how big these files are, data manipulation would have proven unfeasible.

\sphinxAtStartPar
For this reason, we resorted to some useful and popular open source tools, which we used to build \sphinxcode{\sphinxupquote{bash}} scripts and functions to automate conversion from \sphinxcode{\sphinxupquote{.xlsx}} to \sphinxcode{\sphinxupquote{.csv}} files, perform some elementary data cleaning and load the data into a local PostgreSQL database. Format conversion to Comma\sphinxhyphen{}Separated Values (\sphinxcode{\sphinxupquote{.csv}}) was performed using \sphinxhref{https://github.com/wireservice/csvkit}{\sphinxcode{\sphinxupquote{csvkit}}}, a Python package to perform basic operations on \sphinxcode{\sphinxupquote{.csv}} files from the command line. Being written in Python, \sphinxcode{\sphinxupquote{csvkit}} can be slow. However, as part of a major trend for several command\sphinxhyphen{}line applications, \sphinxcode{\sphinxupquote{csvkit}} was rewritten in Rust, a fast and secure programming language whose popularity has been rising in the last couple of years (Perkel, 2020). Much alike Julia (Perkel, 2019), Rust is becoming a tool for data science, as well as scientific computing (for example in bio\sphinxhyphen{}statistics) as it is “a language that offer{[}s{]} the “expressiveness” of Python but the speed of languages such as C and C++” (Perkel, 2020).

\sphinxAtStartPar
The Rust port of \sphinxcode{\sphinxupquote{csvkit}} is called \sphinxhref{https://github.com/BurntSushi/xsv}{\sphinxcode{\sphinxupquote{xsv}}}, and is blazing fast. Much alike \sphinxcode{\sphinxupquote{awk}} (Gawk \sphinxhyphen{} GNU Project \sphinxhyphen{} Free Software Foundation (FSF), n.d.), \sphinxcode{\sphinxupquote{xsv}} can perform filtering operations, but also joins and partitions, as well as computing summary statistics. \sphinxcode{\sphinxupquote{xsv}} does not offer format conversion (yet), but was used to filter out a negligible number of invalid observations from each original \sphinxcode{\sphinxupquote{.xslx}} files (after the conversion to \sphinxcode{\sphinxupquote{.csv}}), and select only the columns that would enter the final dataset.

\sphinxAtStartPar
Finally, \sphinxcode{\sphinxupquote{psql}} (PostgreSQL”s command line utility) was used to upload the “clean” data into a local database instance. PostgreSQL was also used to perform basic survey statistics, like computing the number of rows, and data aggregation (such as counting the number of observations by year). Looking at the frequency tables by year, there appears to be an oddly small number of observations from 2018. This is because there is indeed missing data from June 2018 until the end of the year. For this reason, we chose to work only with data from June 2015 to the end of May 2018.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
        count
date         
2015  1971891
2016  4066783
2017  4272480
2018  1457631
2019  2830566
2020  1243540
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}

\section{Data Analysis}
\label{\detokenize{03-data_ingestion_and_spatial_operations:data-analysis}}
\sphinxAtStartPar
In addition to selecting only trips from June 2015 to June 2018, we also disregard all rentals whose duration is smaller than one minute (around 4000) \sphinxhyphen{} as previously done in the literature (Toro et al., 2020). This leaves us with more than 11,7 million observations. We will temporarily store these in a \sphinxhref{https://www.postgresql.org/docs/current/sql-creatematerializedview.html}{materialised view}, that we will drop at the end of the data analysis.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{create\PYGZus{}materialised\PYGZus{}view}\PYG{p}{(}\PYG{n}{connection}\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{k+kc}{None}\PYG{p}{:}

    \PYG{n}{query\PYGZus{}rentals\PYGZus{}before\PYGZus{}2019}\PYG{p}{:} \PYG{n+nb}{str} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+s2}{        CREATE MATERIALIZED VIEW IF NOT EXISTS bikemi\PYGZus{}rentals.bikemi\PYGZus{}rentals\PYGZus{}before\PYGZus{}2019 AS}
\PYG{l+s+s2}{        (}
\PYG{l+s+s2}{        SELECT b.bici,}
\PYG{l+s+s2}{               b.tipo\PYGZus{}bici,}
\PYG{l+s+s2}{               b.cliente\PYGZus{}anonimizzato,}
\PYG{l+s+s2}{               DATE\PYGZus{}TRUNC(}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{second}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{, b.data\PYGZus{}prelievo)     AS data\PYGZus{}prelievo,}
\PYG{l+s+s2}{               b.numero\PYGZus{}stazione\PYGZus{}prelievo,}
\PYG{l+s+s2}{               b.nome\PYGZus{}stazione\PYGZus{}prelievo,}
\PYG{l+s+s2}{               DATE\PYGZus{}TRUNC(}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{second}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{, b.data\PYGZus{}restituzione) AS data\PYGZus{}restituzione,}
\PYG{l+s+s2}{               b.numero\PYGZus{}stazione\PYGZus{}restituzione,}
\PYG{l+s+s2}{               b.nome\PYGZus{}stazione\PYGZus{}restituzione,}
\PYG{l+s+s2}{               b.durata\PYGZus{}noleggio}
\PYG{l+s+s2}{        FROM bikemi\PYGZus{}rentals.bikemi\PYGZus{}source\PYGZus{}data b}
\PYG{l+s+s2}{        WHERE EXTRACT(}
\PYG{l+s+s2}{                      }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{year}\PYG{l+s+s2}{\PYGZsq{}}
\PYG{l+s+s2}{                      FROM b.data\PYGZus{}restituzione}
\PYG{l+s+s2}{                  ) \PYGZlt{} 2019}
\PYG{l+s+s2}{          AND durata\PYGZus{}noleggio \PYGZgt{} interval }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{1 minute}\PYG{l+s+s2}{\PYGZsq{}}
\PYG{l+s+s2}{            );}
\PYG{l+s+s2}{    }\PYG{l+s+s2}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}

    \PYG{k}{with} \PYG{n}{connection}\PYG{p}{:}
        \PYG{k}{with} \PYG{n}{connection}\PYG{o}{.}\PYG{n}{cursor}\PYG{p}{(}\PYG{p}{)} \PYG{k}{as} \PYG{n}{cursor}\PYG{p}{:}
            \PYG{n}{cursor}\PYG{o}{.}\PYG{n}{execute}\PYG{p}{(}\PYG{n}{query\PYGZus{}rentals\PYGZus{}before\PYGZus{}2019}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
The service has almost two\sphinxhyphen{}hundred thousands unique subscribers in the time period. For the years 2016 and 2017, the only ones for which we have complete data, the number of subscribers is almost a hundred thousand. By lookind at the unique subscribers for the other two years, it might seem that the number of subscribers in the second half of the year is higher.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
    count
0  192431
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
      count
anno       
2015  64079
2016  93239
2017  95931
2018  50860
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
It is also of interest to look at the number of rentals of each user, broken down by year. As expected, there are more observations from the years 2016 and 2017 as these are complete years. The great number of usage translates to an average of almost 4 trips per day \sphinxhyphen{} i.e., to reach the first train station and then the workplace.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
                      noleggi\PYGZus{}totali  anno
cliente\PYGZus{}anonimizzato                      
43969                           1478  2017
146640                          1355  2017
40585                           1290  2017
40585                           1263  2016
188391                          1133  2017
165664                          1056  2016
147597                          1042  2016
19515                           1039  2017
97713                           1025  2017
90177                            988  2016
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}

\subsection{Usage Patterns and Origin\sphinxhyphen{}Destination Matrix}
\label{\detokenize{03-data_ingestion_and_spatial_operations:usage-patterns-and-origin-destination-matrix}}
\sphinxAtStartPar
As a starter, it is useful to look at the origin\sphinxhyphen{}destination (OD) matrix, to see which are the most popular starting and departure points. On the aggregate level, the most popular points on the OD matrix are the train stations and sightseeing places such as Duomo.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
       stazione\PYGZus{}prelievo  numero\PYGZus{}noleggi  stazione\PYGZus{}restituzione  \PYGZbs{}
0              Cadorna 3          234694              Cadorna 3   
1                  Duomo          197573                  Duomo   
2                Moscova          139561                Moscova   
3     Garibaldi \PYGZhy{} Sturzo          134243     Garibaldi \PYGZhy{} Sturzo   
4  San Babila \PYGZhy{} RIMOSSA\PYGZhy{}          128261             XXV Aprile   
5             XXV Aprile          127804  San Babila \PYGZhy{} RIMOSSA\PYGZhy{}   
6              Cadorna 1          118692                Cairoli   
7                Cairoli          108717         Palazzo Marino   
8             Centrale 1          107864              Cadorna 1   
9      Coni Zugna Solari           99152                 Cavour   

   numero\PYGZus{}noleggi  
0          234349  
1          202773  
2          140552  
3          129611  
4          129006  
5          127974  
6          113104  
7          103253  
8          102102  
9           98083  
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
The ranking is basically unchanged if we look only at data from Monday to Friday and within “core” commuting hours (say, from 7 to 10 and from 17 to 20). However, trips towards stations become more frequent and destinations such as Moscova are slightly less popular. Indeed, employees might straight bike to Moscova after work to take a sip from their Negroni.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
       stazione\PYGZus{}prelievo  numero\PYGZus{}noleggi  stazione\PYGZus{}restituzione  \PYGZbs{}
0              Cadorna 3          234694              Cadorna 3   
1                  Duomo          197573                  Duomo   
2                Moscova          139561                Moscova   
3     Garibaldi \PYGZhy{} Sturzo          134243     Garibaldi \PYGZhy{} Sturzo   
4  San Babila \PYGZhy{} RIMOSSA\PYGZhy{}          128261             XXV Aprile   
5             XXV Aprile          127804  San Babila \PYGZhy{} RIMOSSA\PYGZhy{}   
6              Cadorna 1          118692                Cairoli   
7                Cairoli          108717         Palazzo Marino   
8             Centrale 1          107864              Cadorna 1   
9      Coni Zugna Solari           99152                 Cavour   

   numero\PYGZus{}noleggi  
0          234349  
1          202773  
2          140552  
3          129611  
4          129006  
5          127974  
6          113104  
7          103253  
8          102102  
9           98083  
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
The behaviour changes if we look ad the individual trips, i.e. if we \sphinxcode{\sphinxupquote{GROUP BY}} both departure and destination stations (\sphinxcode{\sphinxupquote{nome\_stazione\_prelievo}} and \sphinxcode{\sphinxupquote{nome\_stazione\_restituzione}}). To be exact, \sphinxcode{\sphinxupquote{Coni Zugna Solari}} is close to both the station in Porta Genova as well as the Navigli and Darsena, which partly explains its popularity.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
     stazione\PYGZus{}prelievo   stazione\PYGZus{}destinazione  numero\PYGZus{}noleggi
0    Coni Zugna Solari     Napoli \PYGZhy{} Washington           14144
1  Napoli \PYGZhy{} Washington       Coni Zugna Solari           13256
2            Cadorna 3                   Duomo            9363
3                Duomo               Cadorna 3            8903
4    Coni Zugna Solari        Savona \PYGZhy{} Tolstoj            8217
5       Palazzo Marino               Cadorna 3            7436
6           Bertarelli               Cadorna 3            6967
7  Vercelli \PYGZhy{} Piemonte  Roncaglia \PYGZhy{} Washington            6373
8                Piola       Gorini \PYGZhy{} Strambio            6336
9            Cadorna 3           Arcivescovado            6197
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
The same considerations apply when looking at the top trips only within the “core” commuting hours. This reinforces the conclusion that BikeMi is consistently used for commuting purposes.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
     stazione\PYGZus{}prelievo   stazione\PYGZus{}destinazione  numero\PYGZus{}noleggi
0    Coni Zugna Solari     Napoli \PYGZhy{} Washington           14144
1  Napoli \PYGZhy{} Washington       Coni Zugna Solari           13256
2            Cadorna 3                   Duomo            9363
3                Duomo               Cadorna 3            8903
4    Coni Zugna Solari        Savona \PYGZhy{} Tolstoj            8217
5       Palazzo Marino               Cadorna 3            7436
6           Bertarelli               Cadorna 3            6967
7  Vercelli \PYGZhy{} Piemonte  Roncaglia \PYGZhy{} Washington            6373
8                Piola       Gorini \PYGZhy{} Strambio            6336
9            Cadorna 3           Arcivescovado            6197
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}

\section{Spatial Data Analysis}
\label{\detokenize{03-data_ingestion_and_spatial_operations:spatial-data-analysis}}
\sphinxAtStartPar
On its open data portal, the Comune di Milano publishes all sorts of open data \sphinxhyphen{} like the daily entrances in the so\sphinxhyphen{}called Area C, where access to private cars is limited. On this treasure trove of data, we can also find things like the location of column fountains and newsstands, but also the geo\sphinxhyphen{}referenced data of bike tracks and the location of \sphinxhref{https://dati.comune.milano.it/it/dataset/ds65\_infogeo\_aree\_sosta\_bike\_sharing\_localizzazione\_}{BikeMi Stations}. As noted previously, the service has some 320 stations, spread unevenly across the town, as it was outlined by previous studies (Saibene \& Manzi, 2015). As a starter, we filter out all stations that have been introduced after 2019. This leaves us with 281 official stations, versus 279 in the historic data.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                  nome  municipio  anno  \PYGZbs{}
numero\PYGZus{}stazione                                           
001                              Duomo          1  2008   
402                     San Babila Bis          1  2008   
003                          Cadorna 1          1  2008   
004                              Lanza          1  2008   
005              Universita\PYGZsq{} Cattolica          1  2008   

                          stalls\PYGZus{}geometry  
numero\PYGZus{}stazione                            
001              POINT (9.18914 45.46475)  
402              POINT (9.19725 45.46627)  
003              POINT (9.17566 45.46800)  
004              POINT (9.18197 45.47227)  
005              POINT (9.17641 45.46312)  
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
The data is represented with the (geographic) coordinate reference system (CRS) \sphinxcode{\sphinxupquote{EPSG:4326}}, but in order to use the \sphinxcode{\sphinxupquote{contextily}} library we need to cast it to the (projected) reference system \sphinxcode{\sphinxupquote{EPSG:3587}}. As the map shows, the stalls stretch to the North, towards Bicocca and Sesto San Giovanni. We can already see that the stalls distribution outside the city centre follows bike lanes (in blue).

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{03-data_ingestion_and_spatial_operations_28_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}

\subsection{Inspecting Stations with Zero Daily Rentals}
\label{\detokenize{03-data_ingestion_and_spatial_operations:inspecting-stations-with-zero-daily-rentals}}
\sphinxAtStartPar
The stalls in the outer stations are not as used as the ones in the city centre, which come up as an abundance of zeros in the data aggregated at daily and hourly level. Some of these stations are practically unused. Besides, the great count of stations would represent a problem in the context of multivariate regressions (the so\sphinxhyphen{}called \(p > n\) problem). Hence, we can drop the unused stations from our data to help us reduce the dimensionality.

\sphinxAtStartPar
We start by creating another two \sphinxcode{\sphinxupquote{materialised views}} with the daily and hourly rentals, by station. Since the service is only active between 7 and 24, we just keep hourly observations within that time span. If we simply were to \sphinxcode{\sphinxupquote{GROUP BY}} station names and time units, we would obtain series with gaps in the time index. We first create a table with all possible combinations of stations and dates using a \sphinxcode{\sphinxupquote{CROSS JOIN}} and a common table expression (or \sphinxcode{\sphinxupquote{CTE}}), then left join on this table the values obtained via the \sphinxcode{\sphinxupquote{GROUP BY}} on the reference table. A similar query is used to obtain the hourly rentals, with hourly time intervals instead of daily ones.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{create\PYGZus{}rentals\PYGZus{}materialized\PYGZus{}views}\PYG{p}{(}\PYG{n}{connection}\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{k+kc}{None}\PYG{p}{:}
    
    \PYG{n}{query\PYGZus{}daily\PYGZus{}rentals}\PYG{p}{:} \PYG{n+nb}{str} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+s2}{        CREATE MATERIALIZED VIEW IF NOT EXISTS bikemi\PYGZus{}rentals.daily\PYGZus{}rentals\PYGZus{}before\PYGZus{}2019 AS}
\PYG{l+s+s2}{        (}
\PYG{l+s+s2}{        WITH cross\PYGZus{}table AS (}
\PYG{l+s+s2}{            SELECT d.date AS data\PYGZus{}partenza,}
\PYG{l+s+s2}{                   s.nome AS stazione\PYGZus{}partenza,}
\PYG{l+s+s2}{                   s.numero\PYGZus{}stazione}
\PYG{l+s+s2}{            FROM (}
\PYG{l+s+s2}{                     SELECT *}
\PYG{l+s+s2}{                     FROM bikemi\PYGZus{}rentals.bikemi\PYGZus{}stations}
\PYG{l+s+s2}{                     WHERE anno \PYGZlt{} 2019}
\PYG{l+s+s2}{                 ) s}
\PYG{l+s+s2}{                     CROSS JOIN (}
\PYG{l+s+s2}{                SELECT generate\PYGZus{}series(}
\PYG{l+s+s2}{                               timestamp }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{2015\PYGZhy{}06\PYGZhy{}01}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{,}
\PYG{l+s+s2}{                               timestamp }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{2018\PYGZhy{}06\PYGZhy{}01}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{,}
\PYG{l+s+s2}{                               interval }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{1 day}\PYG{l+s+s2}{\PYGZsq{}}
\PYG{l+s+s2}{                           )::date}
\PYG{l+s+s2}{            ) d(date)}
\PYG{l+s+s2}{            ORDER BY nome,}
\PYG{l+s+s2}{                     date}
\PYG{l+s+s2}{        )}
\PYG{l+s+s2}{        SELECT c.data\PYGZus{}partenza,}
\PYG{l+s+s2}{               c.stazione\PYGZus{}partenza,}
\PYG{l+s+s2}{               c.numero\PYGZus{}stazione,}
\PYG{l+s+s2}{               COUNT(b.*)::smallint AS noleggi\PYGZus{}giornalieri}
\PYG{l+s+s2}{        FROM cross\PYGZus{}table c}
\PYG{l+s+s2}{                 LEFT JOIN bikemi\PYGZus{}rentals.bikemi\PYGZus{}rentals\PYGZus{}before\PYGZus{}2019 b ON b.numero\PYGZus{}stazione\PYGZus{}prelievo = c.numero\PYGZus{}stazione}
\PYG{l+s+s2}{            AND DATE\PYGZus{}TRUNC(}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{day}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{, b.data\PYGZus{}prelievo)::date = c.data\PYGZus{}partenza}
\PYG{l+s+s2}{        GROUP BY c.data\PYGZus{}partenza,}
\PYG{l+s+s2}{                 c.stazione\PYGZus{}partenza,}
\PYG{l+s+s2}{                 c.numero\PYGZus{}stazione}
\PYG{l+s+s2}{        ORDER BY stazione\PYGZus{}partenza,}
\PYG{l+s+s2}{                 data\PYGZus{}partenza}
\PYG{l+s+s2}{            );}
\PYG{l+s+s2}{    }\PYG{l+s+s2}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
    
    \PYG{n}{query\PYGZus{}hourly\PYGZus{}rentals}\PYG{p}{:} \PYG{n+nb}{str} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+s2}{    CREATE MATERIALIZED VIEW IF NOT EXISTS bikemi\PYGZus{}rentals.hourly\PYGZus{}rentals\PYGZus{}before\PYGZus{}2019 AS}
\PYG{l+s+s2}{    (}
\PYG{l+s+s2}{    WITH cross\PYGZus{}table AS (}
\PYG{l+s+s2}{        SELECT d.date\PYGZus{}time AS data\PYGZus{}partenza,}
\PYG{l+s+s2}{               s.nome      AS stazione\PYGZus{}partenza,}
\PYG{l+s+s2}{               s.numero\PYGZus{}stazione}
\PYG{l+s+s2}{        FROM (}
\PYG{l+s+s2}{                 SELECT *}
\PYG{l+s+s2}{                 FROM bikemi\PYGZus{}rentals.bikemi\PYGZus{}stations}
\PYG{l+s+s2}{                 WHERE anno \PYGZlt{} 2019}
\PYG{l+s+s2}{             ) s}
\PYG{l+s+s2}{                 CROSS JOIN (}
\PYG{l+s+s2}{            SELECT generate\PYGZus{}series(}
\PYG{l+s+s2}{                           timestamp }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{2015\PYGZhy{}06\PYGZhy{}01}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{,}
\PYG{l+s+s2}{                           timestamp }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{2018\PYGZhy{}06\PYGZhy{}01}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{,}
\PYG{l+s+s2}{                           interval }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{1 hour}\PYG{l+s+s2}{\PYGZsq{}}
\PYG{l+s+s2}{                       )::timestamp}
\PYG{l+s+s2}{        ) d(date\PYGZus{}time)}
\PYG{l+s+s2}{        WHERE EXTRACT(}
\PYG{l+s+s2}{                      }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{hour}\PYG{l+s+s2}{\PYGZsq{}}
\PYG{l+s+s2}{                      FROM d.date\PYGZus{}time}
\PYG{l+s+s2}{                  ) BETWEEN 7 and 24}
\PYG{l+s+s2}{        ORDER BY nome,}
\PYG{l+s+s2}{                 date\PYGZus{}time}
\PYG{l+s+s2}{    )}
\PYG{l+s+s2}{    SELECT c.data\PYGZus{}partenza,}
\PYG{l+s+s2}{           c.stazione\PYGZus{}partenza,}
\PYG{l+s+s2}{           c.numero\PYGZus{}stazione,}
\PYG{l+s+s2}{           COUNT(b.*)::smallint AS noleggi\PYGZus{}per\PYGZus{}ora}
\PYG{l+s+s2}{    FROM cross\PYGZus{}table c}
\PYG{l+s+s2}{             LEFT JOIN bikemi\PYGZus{}rentals.bikemi\PYGZus{}rentals\PYGZus{}before\PYGZus{}2019 b ON b.numero\PYGZus{}stazione\PYGZus{}prelievo = c.numero\PYGZus{}stazione}
\PYG{l+s+s2}{        AND DATE\PYGZus{}TRUNC(}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{hour}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{, b.data\PYGZus{}prelievo)::timestamp = c.data\PYGZus{}partenza}
\PYG{l+s+s2}{    GROUP BY c.data\PYGZus{}partenza,}
\PYG{l+s+s2}{             c.stazione\PYGZus{}partenza,}
\PYG{l+s+s2}{             c.numero\PYGZus{}stazione}
\PYG{l+s+s2}{    ORDER BY stazione\PYGZus{}partenza,}
\PYG{l+s+s2}{             data\PYGZus{}partenza}
\PYG{l+s+s2}{        );}
\PYG{l+s+s2}{    }\PYG{l+s+s2}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
    
    \PYG{k}{with} \PYG{n}{connection}\PYG{p}{:}
        \PYG{k}{with} \PYG{n}{connection}\PYG{o}{.}\PYG{n}{cursor}\PYG{p}{(}\PYG{p}{)} \PYG{k}{as} \PYG{n}{cursor}\PYG{p}{:}
            \PYG{n}{cursor}\PYG{o}{.}\PYG{n}{execute}\PYG{p}{(}\PYG{n}{query\PYGZus{}daily\PYGZus{}rentals}\PYG{p}{)}
            \PYG{n}{cursor}\PYG{o}{.}\PYG{n}{execute}\PYG{p}{(}\PYG{n}{query\PYGZus{}hourly\PYGZus{}rentals}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
Then, we compute the number of null values in the data (\sphinxcode{\sphinxupquote{null\_obs}}), pivot the table to wider format and compute the percentage of missing values in each station (\sphinxcode{\sphinxupquote{null\_obs}}). Using Pandas”\sphinxcode{\sphinxupquote{cut()}} method, we can convert this numerical column into a categorical variable (\sphinxcode{\sphinxupquote{null\_obs\_ranking}}) and choose the number of levels \sphinxhyphen{} five, in our case \sphinxhyphen{} to split the column into even intervals with.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{obs\PYGZus{}number} \PYG{o}{=} \PYG{n}{daily\PYGZus{}rentals}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{unique}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}

\PYG{n}{stations\PYGZus{}missing\PYGZus{}obs} \PYG{o}{=} \PYG{p}{(}
    \PYG{n}{daily\PYGZus{}rentals}\PYG{p}{[}\PYG{p}{[}\PYG{n}{col} \PYG{k}{for} \PYG{n}{col} \PYG{o+ow}{in} \PYG{n}{daily\PYGZus{}rentals}\PYG{o}{.}\PYG{n}{columns} \PYG{k}{if} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{numero\PYGZus{}stazione}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o+ow}{not} \PYG{o+ow}{in} \PYG{n}{col}\PYG{p}{]}\PYG{p}{]}
        \PYG{o}{.}\PYG{n}{pivot}\PYG{p}{(}\PYG{n}{columns}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{stazione\PYGZus{}partenza}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{o}{.}\PYG{n}{replace}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{nan}\PYG{p}{)}
        \PYG{o}{.}\PYG{n}{isna}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{p}{)}
        \PYG{o}{.}\PYG{n}{sort\PYGZus{}values}\PYG{p}{(}\PYG{n}{ascending}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
        \PYG{o}{.}\PYG{n}{pipe}\PYG{p}{(}\PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{)}
        \PYG{c+c1}{\PYGZsh{} drop the redundant index}
        \PYG{o}{.}\PYG{n}{droplevel}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
        \PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+m+mi}{0}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{null\PYGZus{}obs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
        \PYG{c+c1}{\PYGZsh{} create the \PYGZpc{} by dividing the number of null values by the length of the datetime idnex}
        \PYG{o}{.}\PYG{n}{assign}\PYG{p}{(}\PYG{n}{pct\PYGZus{}null}\PYG{o}{=}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{x}\PYG{o}{.}\PYG{n}{null\PYGZus{}obs} \PYG{o}{/} \PYG{n}{obs\PYGZus{}number}\PYG{p}{)}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} labels for the categorical variable, assumed to be ascending order}
\PYG{n}{labels} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{very\PYGZus{}low}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{low}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{average}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{high}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{very\PYGZus{}high}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}

\PYG{n}{stations\PYGZus{}missing\PYGZus{}obs}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{null\PYGZus{}obs\PYGZus{}ranking}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{cut}\PYG{p}{(}
    \PYG{n}{stations\PYGZus{}missing\PYGZus{}obs}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pct\PYGZus{}null}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{bins}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{labels}\PYG{o}{=}\PYG{n}{labels}
\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
In this way, we can see that the number of stations with an “unacceptable” number of missing values is smaller than thirty.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{03-data_ingestion_and_spatial_operations_36_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
More than 80 percent of the stations display a count of null observations inferior to 20 percent.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{03-data_ingestion_and_spatial_operations_38_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
We can also join this data with the station spatial data to plot them. While this does not expose patterns that could be used to reduce the dimensionality of the data, it shows that there are some stations that need to be dropped off even from the most crowded areas in the city. This could not be spotted before as, to the best of our knowledge, no one in the BikeMi literature has ever found a way to take into account of how public work on roads and infrastructure had effects on the bike sharing service.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{03-data_ingestion_and_spatial_operations_40_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}

\subsection{Area of Analysis}
\label{\detokenize{03-data_ingestion_and_spatial_operations:area-of-analysis}}
\sphinxAtStartPar
Besides dropping the “emptiest” stations, we should also come up with a way to narrow down the geographic area inside which we perform the analysis. Previously, authors have chosen to analyse just the area inside the Bastioni, or “Area C” (Saibene \& Manzi, 2015) or the whole set of stations (Toro et al., 2020). This was mainly due to the different purpose of their analysis and the data availability (Saibene and Manzi analyse data from 2008 to 2012). For our goal, as well as the policymaker perspective, this choice seems restricting, as it leaves out most of the train stations. It is worth noting that analysing the bike sharing traffic inside of Area C can be appropriate: for example, since, the municipality publishes the number of daily accesses to the area, which could be used to evaluate the effect of sharing services on traffic.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{03-data_ingestion_and_spatial_operations_43_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
The area we propose is the road ring across Milan, informally referred to as Circonvallazione. This area encapsulates the city centre, as well as most of the train stations, and is represented by the green shade in the map below. This is arguably limiting, as the area does not take in Lambrate and Villapizzone/Bovisa train stations. However, one might argue that it is unlikely for to choose to go to Lambrate and then rent a bike to get to the city centre, as they can just get to Centrale; the same goes for the other stations. In other words, this area contains the sufficient amount of stations to provide a useful forecast for the policymaker, albeit neglecting the outer stalls.

\sphinxAtStartPar
This approach might just reinforce the bias towards the centre of the city, but given the technical constraints seems to be the more viable option. However, as a comparison, the Area C would only contain one train station, whereas this area contains all of the top rentals stalls from the origin\sphinxhyphen{}destination (OD) matrix.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{03-data_ingestion_and_spatial_operations_46_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
This leaves us with the following stations, which we store as a \sphinxcode{\sphinxupquote{.csv}} file and then upload into our local PostgreSQL database with a Bash script.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{03-data_ingestion_and_spatial_operations_48_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}

\chapter{BikeMi Stalls \sphinxstyleemphasis{k}\sphinxhyphen{}Means Clustering}
\label{\detokenize{04-stations_kmeans:bikemi-stalls-k-means-clustering}}\label{\detokenize{04-stations_kmeans::doc}}

\section{\sphinxstyleemphasis{k}\sphinxhyphen{}Means Clustering Review}
\label{\detokenize{04-stations_kmeans:k-means-clustering-review}}
\sphinxAtStartPar
After our first data selection to remove outliers and restrict the spatial area in which we are conducting our analysis,
we are still left with more than 200 stations, spread across 25 neighbourhoods out of 88 \sphinxhyphen{} identified by the acronym NIL, i.e. \sphinxstyleemphasis{nuclei d’identità locale}. This figure might still be too high, especially as far as multivariate models are concerned: indeed, shrinkage will be necessary in order to avoid highly correlated features (\sphinxstyleemphasis{multicollinearity}).
However, it is still in our interests to reduce the number of series to model even for the univariate forecasting: fitting twenty or two\sphinxhyphen{}hundred series is a different task. Even inspecting the correlation across series becomes a daunting task with such a great number of features.

\sphinxAtStartPar
To do so, we will use \sphinxstyleemphasis{k}\sphinxhyphen{}Means clustering \sphinxhyphen{} a popular method widely used in the sharing\sphinxhyphen{}services literature, especially to identify “virtual stations” in free\sphinxhyphen{}float services (Ma et al., 2018) or to “visualize the spatial distribution of DBS {[}Dockless Bike Sharing{]} and taxis around metro stations” (Li et al., 2019). These “virtual stations” are also called \sphinxstyleemphasis{TAZ}, i.e. Traffic Analysis Zones, and are also used for docked\sphinxhyphen{}bike sharing services (Cantelmo et al., 2020).


\subsection{\sphinxstyleemphasis{k}\sphinxhyphen{}Means Clusttering and its Shortcomings}
\label{\detokenize{04-stations_kmeans:k-means-clusttering-and-its-shortcomings}}
\sphinxAtStartPar
In a few words, with \sphinxstyleemphasis{k}\sphinxhyphen{}Means clustering  we “want to partition the observations into \(K\) clusters such that the total within\sphinxhyphen{}cluster variation {[}also known as  \sphinxstyleemphasis{inertia}{]}, summed over all \(K\) clusters, is as small as possible” (Sohil et al., 2021). The objective function to optimise is usually the squared Euclidean distance. Simply put, \sphinxstyleemphasis{k}\sphinxhyphen{}Means “aims to partition n observations into \(K\) clusters, represented by their centres or means. The centre of each cluster is calculated as the mean of all the instances belonging to that cluster” (Li et al., 2019) and “is extremely efficient and concise for the classification of equivalent multidimensional data” such as sharing services data (Li et al., 2019).

\sphinxAtStartPar
The algorithm begins with randomly choosing clusters centres and, with each iteration, the centres are re\sphinxhyphen{}calculated to reduce the partitioning error \sphinxhyphen{} which decreases monotonically, as \(K\) increases. Basically, in this second step the algorithm “creates new centroids by taking the mean value of all of the samples assigned to each previous centroid {[}…{]} until the centroids do not move significantly” (Clustering, n.d.). However, despite similarity always increasing, values of \(K\) that are too great defy the purpose of this classification algorithm. For this reasons, practitioners and researchers have come up with more or less sophisticated ways to assess the optimal number of clusters, the most common of which is the so\sphinxhyphen{}called “Elbow method”. In a few words, a chosen performance metric is computed for each number of clusters and the optimum is represented by the point at which the performance improvements start to marginally decline.

\sphinxAtStartPar
\sphinxstyleemphasis{k}\sphinxhyphen{}Means clustering scales well with the number of samples \(n\), but assumes convex shapes (i.e., has worse performances where the “true” clusters have elongated or irregular shapes) (Clustering, n.d.). Besides, since the initial position of the cluster is random, it might take some attempt for the algorithm to converge. More importantly, however, \sphinxstyleemphasis{k}\sphinxhyphen{}Means is sensitive to the scales of the variables in the data, so normalising the feature matrix is a crucial step. Finally, \sphinxstyleemphasis{k}\sphinxhyphen{}Means assumes continuous data and is not designed to handle categorical features: “{[}T{]}he \sphinxstyleemphasis{k}\sphinxhyphen{}Means algorithm only works on numerical data, i.e. variables that are measured on a ratio scale {[}…{]}, because it minimises a cost function by changing the means of clusters. This prohibits it from being used in applications where categorical data are involved” (Huang, 1998).


\subsection{Alternative Approaches to \sphinxstyleemphasis{k}\sphinxhyphen{}Means Clustering}
\label{\detokenize{04-stations_kmeans:alternative-approaches-to-k-means-clustering}}
\sphinxAtStartPar
Some workarounds have long been known in the literature: as an example, by changing the distance metrics from the Euclidean distance to the Gower distance, which is a measure of similarity (Gower, 1971), \sphinxstyleemphasis{k}\sphinxhyphen{}Means can be adjusted to cluster categorical variables. However, similarity\sphinxhyphen{}based algorithms often display “quadratic computational costs”, and their usage “hinders” the reputation of \sphinxstyleemphasis{k}\sphinxhyphen{}Means, which is know to be a pretty fast algorithm. As an alternative, new methods have been developed, such as the \sphinxstyleemphasis{k}\sphinxhyphen{}Modes (Huang, 1998), which scale well with the larger and larger datasets we have been getting accustomed to in the past ten years.

\sphinxAtStartPar
Given the data availability, this analysis should not benefit from more sophisticated clustering algorithms. While the chosen sample of stalls would even be small enough to justify an attempt with similarity scores, other meaningful regressor are absent from the data \sphinxhyphen{} especially weather data. The features that we could extract from the data, like the neighbourhood, are in fact highly correlated with the geographic coordinates themselves. Another avenue of research might be to exploit \sphinxstylestrong{spatial attributes}, such as the nature and number of building in an area, to provide quantitative measurements of the characterisation of one geographic area. For example, the number of train and metro stations (and, to a lesser extent, of bus stops), perhaps within a certain radius from the individual station, could be used. The share of residential buildings and firms, or the extension of green areas such as parks, might be another one. Some, if not most, of this data could be retrieved using open sources like Open Street Maps, but is out of the scope for this analysis.

\sphinxAtStartPar
The situation changes when we move from a static clustering approach to a dynamic one. Time series clustering (Ali et al., 2019) seems a promising path of research, as it would allow to implement a novel procedure for feature selection, which could be layered on top of a geographic (or spatial) clustering. Time\sphinxhyphen{}series clustering could be paired with spatial cross\sphinxhyphen{}validation folds, whose importance has been underlined since at least the past ten years (Brenning, 2012) (Roberts et al., 2017).

\sphinxAtStartPar
We know of only one peculiar approach, implemented by Chen and his coauthors (Chen et al., 2016), who implemented a weighted correlation network to account for “contextual factors”. Indeed, according to the authors, “bike usage patterns are highly context dependent: time of the day, day of the week, weather condition, social events, and traffic conditions can all lead to different bike usage patterns”. The authors identify two types of context\sphinxhyphen{}dependencies: “the \sphinxstyleemphasis{common contextual factors} that occur frequently and affect all the stations, such as time and weather” and “the \sphinxstyleemphasis{opportunistic contextual factors} that happen irregularly and only affect a subset of stations, such as social and traffic events” (Chen et al., 2016). The idea behind this is to “build a {[}set of{]} statistical clustering template{[}s{]} using historical records (e.g., a cluster template for sunny weekday rush hours)”, that are automatically switched between according to the values of the other regressors.

\sphinxAtStartPar
To provide a more practical example, let us assume that there are four clusters, the results of the combination two independent variables: whether it is a weekday or weekends, and whether there is sunny or rainy weather. Each of these templates is used to fit a \sphinxstyleemphasis{k}\sphinxhyphen{}Means algorithm (actually, Chen and his colleagues build a “correlation network”) and the resulting clustering labels are ‘switched on and off’ as the weather changes from sunny to rainy and the time from weekdays to weekends.


\section{\sphinxstyleemphasis{k}\sphinxhyphen{}Means Clustering Evaluation Metrics}
\label{\detokenize{04-stations_kmeans:k-means-clustering-evaluation-metrics}}
\sphinxAtStartPar
The main, if not only, hyperparameter to tune in \sphinxstyleemphasis{k}\sphinxhyphen{}Means is, indeed, the number of clusters.
As most machine learning methods, \sphinxstyleemphasis{k}\sphinxhyphen{}Means is a quite old algorithm and has thus been widely studied.
The first metric to look at is indeed the inertia, or \sphinxstyleemphasis{within\sphinxhyphen{}cluster sum\sphinxhyphen{}of\sphinxhyphen{}squares} (\(WSS\)), which is usually computed using the Euclidean norm:
\begin{equation*}
\begin{split}
\sum_{i=0}^{n}\underset{\mu_{j}\in{C}}{min}(||x_{i} - \mu_{j}||^2)
\end{split}
\end{equation*}
\sphinxAtStartPar
Other norms can be used; however, some other performance metrics can only be calculated with the Euclidean distance. While clustering is usually presented as an unsupervised machine\sphinxhyphen{}learning technique, a first set of metrics is actually computed comparing the clustering with the ground truths. This is necessary because the evaluation metrics should not take into account the absolute number of clusters, yet if this clustering defines “separations of the data similar to some ground truth set of classes” (Clustering, n.d.).

\sphinxAtStartPar
Among these metrics there are the \sphinxstyleemphasis{Rand index}, mutual information\sphinxhyphen{}based scores, measures of completeness and homogeneity (or both, such as the \sphinxstyleemphasis{V\sphinxhyphen{}measure}) and Fowlkes\sphinxhyphen{}Mallows scores. There is, however, another category of metrics that does not require a comparison with the ground\sphinxhyphen{}truth: the \sphinxstyleemphasis{silhouette coefficients}, the \sphinxstyleemphasis{Calinski\sphinxhyphen{}Harabasz index}, computed as  and  the \sphinxstyleemphasis{Davies\sphinxhyphen{}Bouldin index}. The downside of these evaluation metrics is that they are not robust against “unconventional” shapes and tend to display “better” values when the clusters are convex.

\sphinxAtStartPar
These measures are computed for each set of data points and the labels assigned with the \sphinxstyleemphasis{k}\sphinxhyphen{}Means. The silhouette score is computed as \(s = \frac{b - a}{max(a, b)}\), where \(a\) is the mean distance between a sample and all points in the same class and \(b\) is the average distance between the sample and the points in the \sphinxstyleemphasis{next nearest} cluster. The silhouette coefficients for all samples are averaged and a higher silhouette coefficient relates to a model with better defined clusters (Clustering, n.d.). For this reason, the silhouette score is defined within \([-1;1]\), and scores closer to \(-1\) denote incorrect clustering and values near \(0\) indicate overlapping data points.

\sphinxAtStartPar
The Calinski\sphinxhyphen{}Harabasz Index is defined as:
\begin{equation*}
\begin{split}
s = \frac{\mathrm{tr}(B_k)}{\mathrm{tr}(W_k)} \times \frac{n_E - k}{k - 1}
\end{split}
\end{equation*}
\sphinxAtStartPar
Where \(B_k\) is the dispersion between clusters and \(W_k\) is the one within clusters and \(n\) is the number of observations in the dataset \(E\). Because of this, the index is a raw number (i.e., it is not normalised between, say, \(0\) and \(1\)). Since we want the clusters to be as far apart as possible and the points inside to be as close as possible, we will choose \(K\) such as it maximises the Calinski\sphinxhyphen{}Harabasz index.

\sphinxAtStartPar
Finally, the Davies\sphinxhyphen{}Bouldin index indicates a better separation between clusters the lower it is, and is computed as the average similarity across the two closer classes \(C_i\) and \(C_k\). The similarity measure between \(C_i\) and \(C_k\) is called \(R_{ij}\) and is defined as \(R_{ij} = \frac{s_i + s_j}{d_{ij}}\), where \(s\) is the average distance between each point of a cluster and its centre, and \$d\_\{ij\} is the distance between the two clusters’ centroids. The Davies\sphinxhyphen{}Bouldin index is thus formally defined as such:
\begin{equation*}
\begin{split}
DB = \frac{1}{k} \sum_{i=1}^k \max_{i \neq j} R_{ij}
\end{split}
\end{equation*}
\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sklearn}\PYG{n+nn}{.}\PYG{n+nn}{metrics} \PYG{k+kn}{import} \PYG{n}{silhouette\PYGZus{}score}\PYG{p}{,} \PYG{n}{davies\PYGZus{}bouldin\PYGZus{}score}\PYG{p}{,} \PYG{n}{calinski\PYGZus{}harabasz\PYGZus{}score}
\PYG{k+kn}{from} \PYG{n+nn}{sklearn}\PYG{n+nn}{.}\PYG{n+nn}{preprocessing} \PYG{k+kn}{import} \PYG{n}{StandardScaler}
\PYG{k+kn}{from} \PYG{n+nn}{sklearn}\PYG{n+nn}{.}\PYG{n+nn}{cluster} \PYG{k+kn}{import} \PYG{n}{KMeans}
\PYG{k+kn}{from} \PYG{n+nn}{sklearn}\PYG{n+nn}{.}\PYG{n+nn}{pipeline} \PYG{k+kn}{import} \PYG{n}{make\PYGZus{}pipeline}


\PYG{k}{def} \PYG{n+nf}{filter\PYGZus{}coords}\PYG{p}{(}\PYG{n}{data}\PYG{p}{:} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{,} \PYG{n}{cols}\PYG{o}{=}\PYG{k+kc}{None}\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{:}
    \PYG{k}{if} \PYG{n}{cols} \PYG{o+ow}{is} \PYG{k+kc}{None}\PYG{p}{:}
        \PYG{n}{cols} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{longitudine}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{latitudine}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}
    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{n}{cols}\PYG{p}{)}


\PYG{n}{selected\PYGZus{}stalls\PYGZus{}lonlat}\PYG{p}{:} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame} \PYG{o}{=} \PYG{n}{bikemi\PYGZus{}selected\PYGZus{}stalls}\PYG{o}{.}\PYG{n}{pipe}\PYG{p}{(}\PYG{n}{filter\PYGZus{}coords}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}

\section{Fitting \sphinxstyleemphasis{k}\sphinxhyphen{}Means on BikeMi Stalls Geographic Data}
\label{\detokenize{04-stations_kmeans:fitting-k-means-on-bikemi-stalls-geographic-data}}
\sphinxAtStartPar
We define two functions, using Python and its \sphinxcode{\sphinxupquote{scikit\sphinxhyphen{}learn}} library. The first one fits one instance of \sphinxstyleemphasis{k}\sphinxhyphen{}Means up to an arbitrarily large number of clusters, and collects the chosen metrics to evaluate their performance. As a graphic aid, the second function plots this data in a grid, to ease graphic analysis. It is worth nothing that \sphinxcode{\sphinxupquote{scikit\sphinxhyphen{}learn}} is widely used in the literature (Cantelmo et al., 2020) (Li et al., 2019).

\sphinxAtStartPar
The \(WSS\) or inertia is not really indicative of a significant value of \(K\). The silhouette coefficient is greatest for a quite small number of clusters (smaller than 5) and in general not greater than 20. This appears to be the case for the Calinski\sphinxhyphen{}Harabasz index too and, while the same cannot be said of the Davies\sphinxhyphen{}Bouldin index, beyond said threshold the index is bound to improve. Our final choice should fall on 18, as we believe that clustering the whole set of stations into three great TAZ bears no practical utility for the purpose of the policymaker \sphinxhyphen{} i.e., forecasting bikes demand in Milan.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}kmeans\PYGZus{}metrics}\PYG{p}{(}\PYG{n}{data}\PYG{p}{,} \PYG{n}{k\PYGZus{}max}\PYG{p}{,} \PYG{n}{random\PYGZus{}state}\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{:}
    \PYG{n}{scaled\PYGZus{}data} \PYG{o}{=} \PYG{n}{StandardScaler}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit\PYGZus{}transform}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}
    \PYG{n}{k\PYGZus{}range} \PYG{o}{=} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{k\PYGZus{}max} \PYG{o}{+} \PYG{l+m+mi}{1}\PYG{p}{)}

    \PYG{n}{Metrics} \PYG{o}{=} \PYG{n+nb}{tuple}\PYG{p}{[}\PYG{n+nb}{float}\PYG{p}{,} \PYG{n+nb}{float}\PYG{p}{,} \PYG{n+nb}{float}\PYG{p}{,} \PYG{n+nb}{float}\PYG{p}{]}

    \PYG{k}{def} \PYG{n+nf}{compute\PYGZus{}scores}\PYG{p}{(}\PYG{n}{source\PYGZus{}data}\PYG{p}{,} \PYG{n}{num\PYGZus{}clusters}\PYG{p}{,} \PYG{n}{rand}\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{n}{Metrics}\PYG{p}{:}
        \PYG{n}{kmeans} \PYG{o}{=} \PYG{n}{KMeans}\PYG{p}{(}\PYG{n}{num\PYGZus{}clusters}\PYG{p}{,} \PYG{n}{random\PYGZus{}state}\PYG{o}{=}\PYG{n}{rand}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{source\PYGZus{}data}\PYG{p}{)}

        \PYG{n}{inertia} \PYG{o}{=} \PYG{n}{kmeans}\PYG{o}{.}\PYG{n}{inertia\PYGZus{}}
        \PYG{n}{silhouette\PYGZus{}coefficient} \PYG{o}{=} \PYG{n}{silhouette\PYGZus{}score}\PYG{p}{(}\PYG{n}{source\PYGZus{}data}\PYG{p}{,} \PYG{n}{kmeans}\PYG{o}{.}\PYG{n}{labels\PYGZus{}}\PYG{p}{,} \PYG{n}{metric}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{euclidean}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n}{calinski\PYGZus{}harabasz} \PYG{o}{=} \PYG{n}{calinski\PYGZus{}harabasz\PYGZus{}score}\PYG{p}{(}\PYG{n}{source\PYGZus{}data}\PYG{p}{,} \PYG{n}{kmeans}\PYG{o}{.}\PYG{n}{labels\PYGZus{}}\PYG{p}{)}
        \PYG{n}{davies\PYGZus{}bouldin} \PYG{o}{=} \PYG{n}{davies\PYGZus{}bouldin\PYGZus{}score}\PYG{p}{(}\PYG{n}{source\PYGZus{}data}\PYG{p}{,} \PYG{n}{kmeans}\PYG{o}{.}\PYG{n}{labels\PYGZus{}}\PYG{p}{)}

        \PYG{k}{return} \PYG{n}{inertia}\PYG{p}{,} \PYG{n}{silhouette\PYGZus{}coefficient}\PYG{p}{,} \PYG{n}{calinski\PYGZus{}harabasz}\PYG{p}{,} \PYG{n}{davies\PYGZus{}bouldin}

    \PYG{n}{scores}\PYG{p}{:} \PYG{n+nb}{list}\PYG{p}{[}\PYG{n}{Metrics}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{n}{compute\PYGZus{}scores}\PYG{p}{(}\PYG{n}{scaled\PYGZus{}data}\PYG{p}{,} \PYG{n}{k}\PYG{p}{,} \PYG{n}{random\PYGZus{}state}\PYG{p}{)} \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n}{k\PYGZus{}range}\PYG{p}{]}

    \PYG{n}{output}\PYG{p}{:} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}
        \PYG{n}{scores}\PYG{p}{,}
        \PYG{n}{index}\PYG{o}{=}\PYG{n}{k\PYGZus{}range}\PYG{p}{,}
        \PYG{n}{columns}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{inertia}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{silhouette\PYGZus{}coefficient}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{calinski\PYGZus{}harabasz}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{davies\PYGZus{}bouldin}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}
    \PYG{p}{)}

    \PYG{n}{output}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{name} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{k}\PYG{l+s+s2}{\PYGZdq{}}

    \PYG{k}{return} \PYG{n}{output}


\PYG{k}{def} \PYG{n+nf}{plot\PYGZus{}all\PYGZus{}metrics}\PYG{p}{(}\PYG{n}{metrics\PYGZus{}data}\PYG{p}{:} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{k+kc}{None}\PYG{p}{:}
    \PYG{k}{def} \PYG{n+nf}{plot\PYGZus{}metric}\PYG{p}{(}\PYG{n}{dataf}\PYG{p}{:} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{,} \PYG{n}{col}\PYG{p}{:} \PYG{n+nb}{str}\PYG{p}{,} \PYG{n}{\PYGZus{}ax}\PYG{p}{:} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{Axes}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{plot\PYGZus{}title}\PYG{p}{:} \PYG{n+nb}{str} \PYG{o}{=} \PYG{n}{col}\PYG{o}{.}\PYG{n}{replace}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZus{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ }\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{\PYGZus{}ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{dataf}\PYG{p}{[}\PYG{n}{col}\PYG{p}{]}\PYG{p}{)}
        \PYG{n}{\PYGZus{}ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{plot\PYGZus{}title}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{o}{*}\PYG{o}{*}\PYG{n}{title\PYGZus{}font}\PYG{p}{)}

    \PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{12}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{for} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{metric} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,} \PYG{n}{metrics\PYGZus{}data}\PYG{o}{.}\PYG{n}{columns}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{plot\PYGZus{}metric}\PYG{p}{(}\PYG{n}{metrics\PYGZus{}data}\PYG{p}{,} \PYG{n}{metric}\PYG{p}{,} \PYG{n}{ax}\PYG{p}{)}


\PYG{n}{selected\PYGZus{}stalls\PYGZus{}metrics} \PYG{o}{=} \PYG{n}{get\PYGZus{}kmeans\PYGZus{}metrics}\PYG{p}{(}\PYG{n}{selected\PYGZus{}stalls\PYGZus{}lonlat}\PYG{p}{,} \PYG{l+m+mi}{70}\PYG{p}{,} \PYG{l+m+mi}{42}\PYG{p}{)}

\PYG{n}{plot\PYGZus{}all\PYGZus{}metrics}\PYG{p}{(}\PYG{n}{selected\PYGZus{}stalls\PYGZus{}metrics}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{04-stations_kmeans_9_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
However, as mentioned above, the total number of neighbourhoods inside our area of analysis is 25: at this point, the policymaker might just be better off aggregating the data by neighbourhood, without going through the hassle of computing the \sphinxstyleemphasis{k}\sphinxhyphen{}Means. Indeed, in this context the purpose of fitting a \sphinxstyleemphasis{k}\sphinxhyphen{}Means should be to isolate a small amount of Traffic Analysis Zones inside each neighbourhood, in order to be able to aggregate together stations that are quite close to each other and that cannot all be used at once as independent variables for the forecasting models without injecting error in the estimates via multicollinearity. In this way, it would also be possible to include neighbourhood fixed effects \sphinxhyphen{} which would otherwise be impossible to add to the regression if data was aggregated ad that level.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{fit\PYGZus{}kmeans}\PYG{p}{(}\PYG{n}{input\PYGZus{}data}\PYG{p}{,} \PYG{n}{k}\PYG{p}{,} \PYG{n}{rand}\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{n+nb}{object}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{make\PYGZus{}pipeline}\PYG{p}{(}\PYG{n}{StandardScaler}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{KMeans}\PYG{p}{(}\PYG{n}{n\PYGZus{}clusters}\PYG{o}{=}\PYG{n}{k}\PYG{p}{,} \PYG{n}{random\PYGZus{}state}\PYG{o}{=}\PYG{n}{rand}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{input\PYGZus{}data}\PYG{p}{)}


\PYG{k}{def} \PYG{n+nf}{assign\PYGZus{}clusters}\PYG{p}{(}\PYG{n}{input\PYGZus{}data}\PYG{p}{:} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{,} \PYG{n}{fitted\PYGZus{}kmeans}\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{input\PYGZus{}data}\PYG{o}{.}\PYG{n}{assign}\PYG{p}{(}\PYG{n}{cluster}\PYG{o}{=}\PYG{n}{fitted\PYGZus{}kmeans}\PYG{o}{.}\PYG{n}{labels\PYGZus{}}\PYG{p}{)}


\PYG{k}{def} \PYG{n+nf}{make\PYGZus{}geodataframe}\PYG{p}{(}
        \PYG{n}{data}\PYG{p}{:} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{,}
        \PYG{n}{cols}\PYG{o}{=}\PYG{k+kc}{None}\PYG{p}{,}
        \PYG{n}{crs}\PYG{p}{:} \PYG{n+nb}{int} \PYG{o}{=} \PYG{l+m+mi}{4326}
\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{n}{geopandas}\PYG{o}{.}\PYG{n}{GeoDataFrame}\PYG{p}{:}
    \PYG{k}{if} \PYG{n}{cols} \PYG{o+ow}{is} \PYG{k+kc}{None}\PYG{p}{:}
        \PYG{n}{cols} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{longitudine}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{latitudine}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}
    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{pipe}\PYG{p}{(}
        \PYG{n}{geopandas}\PYG{o}{.}\PYG{n}{GeoDataFrame}\PYG{p}{,}
        \PYG{n}{geometry}\PYG{o}{=}\PYG{n}{geopandas}\PYG{o}{.}\PYG{n}{points\PYGZus{}from\PYGZus{}xy}\PYG{p}{(}
            \PYG{n}{data}\PYG{p}{[}\PYG{n}{cols}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,}
            \PYG{n}{data}\PYG{p}{[}\PYG{n}{cols}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,}
            \PYG{n}{crs}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}
    \PYG{p}{)}


\PYG{k}{def} \PYG{n+nf}{plot\PYGZus{}clusters}\PYG{p}{(}
        \PYG{n}{geodata}\PYG{p}{:} \PYG{n}{geopandas}\PYG{o}{.}\PYG{n}{GeoDataFrame}\PYG{p}{,}
        \PYG{n}{cluster\PYGZus{}col}\PYG{p}{:} \PYG{n+nb}{str}\PYG{p}{,}
        \PYG{n}{layer}\PYG{p}{:} \PYG{n}{Union}\PYG{p}{[}\PYG{n}{geopandas}\PYG{o}{.}\PYG{n}{GeoDataFrame}\PYG{p}{,} \PYG{k+kc}{None}\PYG{p}{]}
\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{k+kc}{None}\PYG{p}{:}
    \PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{12}\PYG{p}{)}\PYG{p}{)}

    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{off}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{num\PYGZus{}of\PYGZus{}clusters}\PYG{p}{:} \PYG{n+nb}{int} \PYG{o}{=} \PYG{n}{geodata}\PYG{p}{[}\PYG{n}{cluster\PYGZus{}col}\PYG{p}{]}\PYG{o}{.}\PYG{n}{nunique}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Bikemi Stalls, Result of KMeans Clustering (\PYGZdl{}k\PYGZdl{} = }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{num\PYGZus{}of\PYGZus{}clusters}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{o}{*}\PYG{o}{*}\PYG{n}{title\PYGZus{}font}\PYG{p}{)}

    \PYG{k}{if} \PYG{n}{layer} \PYG{o+ow}{is} \PYG{o+ow}{not} \PYG{k+kc}{None}\PYG{p}{:}
        \PYG{n}{layer}\PYG{o}{.}\PYG{n}{to\PYGZus{}crs}\PYG{p}{(}\PYG{l+m+mi}{3857}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{summer}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.05}\PYG{p}{)}
    \PYG{n}{geodata}\PYG{o}{.}\PYG{n}{to\PYGZus{}crs}\PYG{p}{(}\PYG{l+m+mi}{3857}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{column}\PYG{o}{=}\PYG{n}{cluster\PYGZus{}col}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{)}
    \PYG{n}{cx}\PYG{o}{.}\PYG{n}{add\PYGZus{}basemap}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{kmeans\PYGZus{}18} \PYG{o}{=} \PYG{n}{fit\PYGZus{}kmeans}\PYG{p}{(}\PYG{n}{selected\PYGZus{}stalls\PYGZus{}lonlat}\PYG{p}{,} \PYG{n}{k}\PYG{o}{=}\PYG{l+m+mi}{18}\PYG{p}{,} \PYG{n}{rand}\PYG{o}{=}\PYG{l+m+mi}{42}\PYG{p}{)}

\PYG{n}{selected\PYGZus{}stalls\PYGZus{}18k}\PYG{p}{:} \PYG{n}{geopandas}\PYG{o}{.}\PYG{n}{GeoDataFrame} \PYG{o}{=} \PYG{p}{(}
    \PYG{n}{selected\PYGZus{}stalls\PYGZus{}lonlat}
        \PYG{o}{.}\PYG{n}{pipe}\PYG{p}{(}\PYG{n}{assign\PYGZus{}clusters}\PYG{p}{,} \PYG{n}{fitted\PYGZus{}kmeans}\PYG{o}{=}\PYG{n}{kmeans\PYGZus{}18}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
        \PYG{o}{.}\PYG{n}{pipe}\PYG{p}{(}\PYG{n}{make\PYGZus{}geodataframe}\PYG{p}{)}
\PYG{p}{)}

\PYG{n}{plot\PYGZus{}clusters}\PYG{p}{(}
    \PYG{n}{selected\PYGZus{}stalls\PYGZus{}18k}\PYG{p}{,}
    \PYG{n}{cluster\PYGZus{}col}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cluster}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{layer}\PYG{o}{=}\PYG{n}{nils}\PYG{o}{.}\PYG{n}{sjoin}\PYG{p}{(}\PYG{n}{selected\PYGZus{}stalls\PYGZus{}18k}\PYG{p}{)}
\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{04-stations_kmeans_12_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
If we sort the metrics matrix by the values of \sphinxcode{\sphinxupquote{sihlouette\_coefficient}}, the first number of clusters greater than 25 than we meet is 46. This, however, is only the 18th best value for \(K\) according to the \sphinxcode{\sphinxupquote{silhouette\_score}}.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}k\PYGZus{}greater\PYGZus{}than\PYGZus{}25}\PYG{p}{(}\PYG{n}{metrics\PYGZus{}data}\PYG{p}{:} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{,} \PYG{n}{metric}\PYG{p}{:} \PYG{n+nb}{str} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{silhouette\PYGZus{}coefficient}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{metrics\PYGZus{}data}\PYG{o}{.}\PYG{n}{sort\PYGZus{}values}\PYG{p}{(}\PYG{n}{metric}\PYG{p}{,} \PYG{n}{ascending}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}\PYG{o}{.}\PYG{n}{assign}\PYG{p}{(}\PYG{n}{ranking}\PYG{o}{=}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{metrics\PYGZus{}data}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{query}\PYG{p}{(}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{k \PYGZgt{} 25}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}


\PYG{n}{get\PYGZus{}k\PYGZus{}greater\PYGZus{}than\PYGZus{}25}\PYG{p}{(}\PYG{n}{selected\PYGZus{}stalls\PYGZus{}metrics}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
     inertia  silhouette\PYGZus{}coefficient  calinski\PYGZus{}harabasz  davies\PYGZus{}bouldin  \PYGZbs{}
k                                                                         
46  7.098486                0.340648         191.620618        0.694719   

    ranking  
k            
46       18  
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{kmeans\PYGZus{}46} \PYG{o}{=} \PYG{n}{fit\PYGZus{}kmeans}\PYG{p}{(}\PYG{n}{selected\PYGZus{}stalls\PYGZus{}lonlat}\PYG{p}{,} \PYG{n}{k}\PYG{o}{=}\PYG{l+m+mi}{46}\PYG{p}{,} \PYG{n}{rand}\PYG{o}{=}\PYG{l+m+mi}{42}\PYG{p}{)}

\PYG{n}{selected\PYGZus{}stalls\PYGZus{}46k}\PYG{p}{:} \PYG{n}{geopandas}\PYG{o}{.}\PYG{n}{GeoDataFrame} \PYG{o}{=} \PYG{p}{(}
    \PYG{n}{selected\PYGZus{}stalls\PYGZus{}lonlat}
        \PYG{o}{.}\PYG{n}{pipe}\PYG{p}{(}\PYG{n}{assign\PYGZus{}clusters}\PYG{p}{,} \PYG{n}{kmeans\PYGZus{}46}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
        \PYG{o}{.}\PYG{n}{pipe}\PYG{p}{(}\PYG{n}{make\PYGZus{}geodataframe}\PYG{p}{)}
\PYG{p}{)}

\PYG{n}{selected\PYGZus{}nills\PYGZus{}46k}\PYG{p}{:} \PYG{n}{geopandas}\PYG{o}{.}\PYG{n}{GeoDataFrame} \PYG{o}{=} \PYG{n}{nils}\PYG{o}{.}\PYG{n}{sjoin}\PYG{p}{(}\PYG{n}{selected\PYGZus{}stalls\PYGZus{}46k}\PYG{p}{)}

\PYG{n}{plot\PYGZus{}clusters}\PYG{p}{(}
    \PYG{n}{selected\PYGZus{}stalls\PYGZus{}46k}\PYG{p}{,}
    \PYG{n}{cluster\PYGZus{}col}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cluster}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{layer}\PYG{o}{=}\PYG{n}{selected\PYGZus{}nills\PYGZus{}46k}
\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{04-stations_kmeans_15_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
After choosing the value for \(K\), stall data is aggregated to compute the coordinates of these new “virtual stalls” as the average of the coordinates of the stations inside the cluster. Because of how spatial joins work, one neighbourhood is not plotted, and there seems to be one cluster without left without a NIL. However, the identifier (\sphinxcode{\sphinxupquote{12}}, i.e. Maciachini \sphinxhyphen{} Maggiolina) is still correctly assigned. As the last step, these virtual clusters are assigned with a join operation to the list of selected stalls, and exported.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{plot\PYGZus{}virtual\PYGZus{}clusters}\PYG{p}{(}
        \PYG{n}{virtual\PYGZus{}clusters}\PYG{p}{:} \PYG{n}{geopandas}\PYG{o}{.}\PYG{n}{GeoDataFrame}\PYG{p}{,}
        \PYG{n}{layer}\PYG{p}{:} \PYG{n}{Union}\PYG{p}{[}\PYG{n}{geopandas}\PYG{o}{.}\PYG{n}{GeoDataFrame}\PYG{p}{,} \PYG{k+kc}{None}\PYG{p}{]}
\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{k+kc}{None}\PYG{p}{:}
    \PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{if} \PYG{n}{layer} \PYG{o+ow}{is} \PYG{o+ow}{not} \PYG{k+kc}{None}\PYG{p}{:}
        \PYG{n}{layer}\PYG{o}{.}\PYG{n}{to\PYGZus{}crs}\PYG{p}{(}\PYG{l+m+mi}{3857}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{summer}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.05}\PYG{p}{)}
    \PYG{n}{virtual\PYGZus{}clusters}\PYG{o}{.}\PYG{n}{to\PYGZus{}crs}\PYG{p}{(}\PYG{l+m+mi}{3857}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{)}
    \PYG{n}{cx}\PYG{o}{.}\PYG{n}{add\PYGZus{}basemap}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{off}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Virtual Stalls \PYGZhy{} KMeans Clustering (\PYGZdl{}k\PYGZdl{}=46)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{o}{*}\PYG{o}{*}\PYG{n}{title\PYGZus{}font}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}


\PYG{n}{virtual\PYGZus{}stalls}\PYG{p}{:} \PYG{n}{geopandas}\PYG{o}{.}\PYG{n}{GeoDataFrame} \PYG{o}{=} \PYG{p}{(}
    \PYG{n}{selected\PYGZus{}stalls\PYGZus{}46k}
        \PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cluster}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{[}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{longitudine}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{latitudine}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{]}
        \PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}
        \PYG{o}{.}\PYG{n}{pipe}\PYG{p}{(}\PYG{n}{make\PYGZus{}geodataframe}\PYG{p}{)}
        \PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{longitudine}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{lon\PYGZus{}cluster}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{latitudine}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{lat\PYGZus{}cluster}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
        \PYG{o}{.}\PYG{n}{sjoin}\PYG{p}{(}\PYG{n}{nils}\PYG{p}{,} \PYG{n}{how}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{left}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{index\PYGZus{}right}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{id\PYGZus{}nil}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{p}{)}

\PYG{n}{plot\PYGZus{}virtual\PYGZus{}clusters}\PYG{p}{(}\PYG{n}{virtual\PYGZus{}stalls}\PYG{p}{,} \PYG{n}{layer}\PYG{o}{=}\PYG{n}{selected\PYGZus{}nills\PYGZus{}46k}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{04-stations_kmeans_17_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}

\chapter{Time Series Analysis}
\label{\detokenize{05-time_series_analysis:time-series-analysis}}\label{\detokenize{05-time_series_analysis::doc}}
\sphinxAtStartPar
The cluster table is uploaded to the local database using a Bash script that calls PostgreSQL’s \sphinxcode{\sphinxupquote{psql}} under the hood. Then, this table is \sphinxcode{\sphinxupquote{JOIN}}\sphinxhyphen{}ed with the \sphinxcode{\sphinxupquote{MATERIALIZED VIEW}} with hourly rentals to create a new \sphinxcode{\sphinxupquote{MATERIALIZED VIEW}}, that aggregates the individual station time series to the Traffic Analysis Zone level.

\sphinxAtStartPar
The resulting data is an instance of the so\sphinxhyphen{}called “long” or panel data format, with 18632 rows for each of the 46 time series. The number is actually smaller it would be if we had three years of hourly observations, because as the service is not active between midnight and 7 a.m.: in other words, these series have ‘holes’.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
cluster              0   1   2   3   4
data\PYGZus{}partenza                         
2015\PYGZhy{}06\PYGZhy{}01 07:00:00  1  11   0   8  21
2015\PYGZhy{}06\PYGZhy{}01 08:00:00  2   9   6   6  10
2015\PYGZhy{}06\PYGZhy{}01 09:00:00  3   8  11  16   9
2015\PYGZhy{}06\PYGZhy{}01 10:00:00  2   6  18   6  19
2015\PYGZhy{}06\PYGZhy{}01 11:00:00  5  15  19  16  12
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
The cluster labels are just a range of integers, which the overall interpretability. The issue is quickly solved by creating a small function that assigns a new identifier to the cluster, simply by merging the cluster label with the neighbourhood it is located in.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
                        cluster\PYGZus{}nil
cluster                            
0                            FARINI
1        PORTA TICINESE \PYGZhy{} CONCHETTA
2                             DUOMO
3                            PAGANO
4             GIARDINI P.TA VENEZIA
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
cluster\PYGZus{}nil          Brera \PYGZhy{} 25  Brera \PYGZhy{} 26  Brera \PYGZhy{} 43
data\PYGZus{}partenza                                          
2015\PYGZhy{}06\PYGZhy{}01 07:00:00           7           7          12
2015\PYGZhy{}06\PYGZhy{}01 08:00:00          11           5           9
2015\PYGZhy{}06\PYGZhy{}01 09:00:00           6           9          13
2015\PYGZhy{}06\PYGZhy{}01 10:00:00          11           7           8
2015\PYGZhy{}06\PYGZhy{}01 11:00:00          16          14          11
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}

\section{Time Series Analysis}
\label{\detokenize{05-time_series_analysis:id1}}
\sphinxAtStartPar
Visualising high\sphinxhyphen{}dimensionality datasets can be quite a challenge, which will also represent itself in when fitting the models. As a shortcut, we can compare the TAZ series inside the same NIL to spot different patterns that might occur.

\sphinxAtStartPar
We choose to visualise data throughout the month of October 2016, as the demand is generally higher in autumn, and this should highlight different seasonality patterns better. October 1st, 2016 starts as a Saturday and it is immediate to see that peak hours are around lunchtime. During weekdays, the distribution seems bimodal, with a smaller peak in the mornings.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{05-time_series_analysis_8_0}.png}

\noindent\sphinxincludegraphics{{05-time_series_analysis_8_1}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
Data in \sphinxcode{\sphinxupquote{Brera}} TAZs is quite similar: this is because all stations in Brera are all above the average, when ranking the clusters by absolute number of rentals across the observed time period:

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{05-time_series_analysis_10_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
Some different patterns can be seen in, for example, in the NIL \sphinxcode{\sphinxupquote{Porta Ticinese \sphinxhyphen{} Conca Del Naviglio}} the two TAZ \sphinxcode{\sphinxupquote{20}} and \sphinxcode{\sphinxupquote{31}}, or between \sphinxcode{\sphinxupquote{Stazione Centrale \sphinxhyphen{} Ponte Seveso}} number \sphinxcode{\sphinxupquote{18}} and \sphinxcode{\sphinxupquote{37}}. The first Traffic Analysis Zone in these areas is always in the top of the ladder, while the second is closer to the tail, and as such the demand in the two clusters behaves differently: in number \sphinxcode{\sphinxupquote{20}}, during weekdays the two modes appear to be much closer to each other, while in \sphinxcode{\sphinxupquote{31}} it is not unusual for the morning peak to be greater.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{05-time_series_analysis_12_0}.png}

\noindent\sphinxincludegraphics{{05-time_series_analysis_12_1}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
This heterogeneity is what Chen and his coauthors (Chen et al., 2016) refer to as \sphinxstyleemphasis{opportunistic contextual factors}. From these figures we can also clearly identify the \sphinxstyleemphasis{common contextual factors}: between the 13th and 15th of October, the demand decreases significantly across every station. This was due because of heavier rain than usual being expected for the day \sphinxhyphen{} between 20mm and 30mm.


\section{Last Aggregations and Time Series Decomposition}
\label{\detokenize{05-time_series_analysis:last-aggregations-and-time-series-decomposition}}
\sphinxAtStartPar
Before proceeding, however, data is further aggregated at daily level. Daily forecasts can be of lesser usefulness for bike\sphinxhyphen{}sharing services (BSS) managers, especially to those who implement dynamic rebalancing, i.e. redistribute bikes during the day. Daily forecasts are still employed in the literature (Cantelmo et al., 2020), while smaller and mixed time\sphinxhyphen{}intervals are more frequent especially in deep\sphinxhyphen{}learing approaches: either hourly (Ai et al., 2019) or even in 10, 15, 20 and 30 minutes intervals (Xu et al., 2018). Sometimes, even daily and hourly forecasts are developed (Salaken et al., 2015).

\sphinxAtStartPar
In this last paper, the authors employ a fuzzy inference mechanism to forecast demand, with a dataset with two years worth of observations. The authors find that a fuzzy inference mechanism can outperform a long short\sphinxhyphen{}term memory neural network (LSTM NN) “without performing any optimization on either FLS {[}Fuzzy Logic System{]} parameters or neural network parameters”, but admit that a better tuned LSTM might still be better. More importantly, however, the authors note that “one out of every six samples is taken into consideration for hourly forecast to reduce the forecasting time” (Salaken et al., 2015).

\sphinxAtStartPar
Hamand and his coauthors (Hamad et al., 2021) develop a forecasting model for CitiBike, New York’s BSS, using hourly data, and conclude that “complex seasonalities should be taken into account in traditional time series models”. Hourly data allows to capture three types of seasonalities: yearly, weekly, and daily. However, the available data is only a year\sphinxhyphen{}long and, therefore, “only weekly, and daily seasonality are considered”.

\sphinxAtStartPar
The choice to further aggregate the data at the daily level stems from these considerations, and more. First, more fine\sphinxhyphen{}grained predictions are usually dealt with deep\sphinxhyphen{}learning models. In other cases, like that of Hamand et al., hourly forecasts are associated with shorter time intervals, while we want to exploit yearly seasonalities fully. Statistical models like seasonal ARIMA (SARIMA) do not perform well with long seasonality and “cannot deal with multiple seasonality as well” (Hamad et al., 2021) and, for this reason, shorter time windows are used to compute the forecast with hourly intervals. Choosing a hourly forecasting horizon would likely imply to sample data from one year only, in order to shorten the duration of model fitting. Finally, and perhaps more importantly, the rest of the literature often employs external weather data, especially rain measurements (An et al., 2019) (Heinen et al., 2011) (Thomas et al., 2013). Since we do not possess external data, we rely on the yearly seasonalities to convey the weather signal, which might not be carried by shorter forecasting windows.


\subsection{Time Aggregation Implementation}
\label{\detokenize{05-time_series_analysis:time-aggregation-implementation}}
\sphinxAtStartPar
This last aggregation is once again performed on the local database, since the query language is optimized to perform these operations without reading data into memory. The query is a slight variation of the one used to retrieve hourly demand at the TAZ level, that retrieves the clusters identifiers and the neighbourhood as a unique string:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{CREATE} \PYG{k}{MATERIALIZED} \PYG{k}{VIEW} \PYG{k}{IF} \PYG{k}{NOT} \PYG{k}{EXISTS} \PYG{n}{clusters\PYGZus{}daily\PYGZus{}rentals} \PYG{k}{AS}
\PYG{p}{(}
\PYG{k}{SELECT}
    \PYG{n}{drb2019}\PYG{l+m+mf}{.}\PYG{n}{data\PYGZus{}partenza}\PYG{p}{,}
    \PYG{n}{bcs}\PYG{l+m+mf}{.}\PYG{n}{cluster\PYGZus{}nil} \PYG{o}{||} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ \PYGZhy{} }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{||} \PYG{n}{bcs}\PYG{l+m+mf}{.}\PYG{k}{cluster} \PYG{k}{AS} \PYG{k}{cluster}\PYG{p}{,}
    \PYG{n}{SUM}\PYG{p}{(}\PYG{n}{drb2019}\PYG{l+m+mf}{.}\PYG{n}{noleggi\PYGZus{}giornalieri}\PYG{p}{)} \PYG{k}{AS} \PYG{n}{noleggi\PYGZus{}giornalieri}
\PYG{k}{FROM} \PYG{n}{daily\PYGZus{}rentals\PYGZus{}before\PYGZus{}2019} \PYG{n}{drb2019}
         \PYG{k}{JOIN} \PYG{n}{bikemi\PYGZus{}clustered\PYGZus{}stalls} \PYG{n}{bcs} \PYG{k}{on} \PYG{n}{drb2019}\PYG{l+m+mf}{.}\PYG{n}{numero\PYGZus{}stazione} \PYG{o}{=} \PYG{n}{bcs}\PYG{l+m+mf}{.}\PYG{n}{numero\PYGZus{}stazione}
\PYG{k}{GROUP} \PYG{k}{BY} \PYG{n}{drb2019}\PYG{l+m+mf}{.}\PYG{n}{data\PYGZus{}partenza}\PYG{p}{,} \PYG{n}{bcs}\PYG{l+m+mf}{.}\PYG{k}{cluster}\PYG{p}{,} \PYG{n}{bcs}\PYG{l+m+mf}{.}\PYG{n}{cluster\PYGZus{}nil}
\PYG{k}{ORDER} \PYG{k}{BY} \PYG{n}{bcs}\PYG{l+m+mf}{.}\PYG{k}{cluster}\PYG{p}{,} \PYG{n}{drb2019}\PYG{l+m+mf}{.}\PYG{n}{data\PYGZus{}partenza}
    \PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\sphinxAtStartPar
And then read the final data into memory.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}

\section{Seasonal Decomposition}
\label{\detokenize{05-time_series_analysis:seasonal-decomposition}}
\sphinxAtStartPar
Python library \sphinxcode{\sphinxupquote{statsmodels}} is the choice to perform seasonal decompositions (Seabold \& Perktold, 2010). Simply put, seasonal decomposition assumes that a time\sphinxhyphen{}series is made up of components: a trend (and cycle) \(T\), the seasonality \(S\) and the remainder \(R\) (Hyndman \& Athanasopoulos, 2021). A trend is a long\sphinxhyphen{}term increase or decrease in the data. Seasonalities are cyclical variations of the data that occur with fixed and known period, while cycles do not exhibit a clear frequency (such as, for example, the economic cycle).

\sphinxAtStartPar
As a starter, the base function \sphinxcode{\sphinxupquote{seasonal\_decompose}} implements additive and multiplicative decompositions. The models behind these two strategies are quite simple: \(y_t = S_t + T_t + R_t\) for the additive model and \(y_t = S_t \times T_t \times R_t\). The multiplicative specification is preferred when the magnitude of seasonal fluctuations varies around the level of the time series. Also, it is worth noting that the two equations are convertible: \(y_t = S_t \times T_t \times R_t\) is equivalent to \(logy_t = logS_t + logT_t + logR_t\).

\sphinxAtStartPar
The algorithm that performs the decomposition is quite simple: first, a moving\sphinxhyphen{}average is fit using a time window that is twice the size of the periodicity of the series. For example, monthly data will have a window \(m\) of 12 observations. i.e. twelve months. This will be our estimated trend\sphinxhyphen{}cycle component \(\hat{T}_t\), which is then subtracted from the observed data. The seasonal component \(\hat{S}_t\) is computed as the average of the de\sphinxhyphen{}trended data for that season: for example, with monthly periodicity an average is computed for each month using the values of each month. The residuals \(\hat{R}_t\) are obtained subtracting the seasonal component from the de\sphinxhyphen{}trended series. This applies to additive models; for multiplicative specifications, every subtraction is replaced with a division.

\sphinxAtStartPar
These techniques are quite rudimentary, so much so that \sphinxcode{\sphinxupquote{statsmodels}} recommends applying more sophisticated techniques. As an example, classical decomposition (which dates back to the 1920s) is unable to capture variation in the seasonal cycle, which is assumed to be the same from year to year. Nonetheless, they represent a good starting point to identify patterns in the time series, and the building block for more advanced strategies. As we are dealing with daily data, there will be two main seasonalities we want to identify: yearly and weekly patterns.

\sphinxAtStartPar
The first thing that comes up is that the seasonal pattern is quite tight: this is because weekly seasonalities are fit in a span of two years. The \sphinxcode{\sphinxupquote{seasonal\_decompose}} function requires at least two “complete cycles” of data, i.e. two years should be enough for our purposes. The function by default uses the same periodicity as the time\sphinxhyphen{}index of the \sphinxcode{\sphinxupquote{pandas.DataFrame}} passed as data argument: in this case, daily. We would also override it to display only higher order seasonalities, for example by setting a week\sphinxhyphen{}long period. The trend can also be estimated with a least\sphinxhyphen{}squares regression using an input number of data points.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{statsmodels}\PYG{n+nn}{.}\PYG{n+nn}{tsa}\PYG{n+nn}{.}\PYG{n+nn}{seasonal} \PYG{k+kn}{import} \PYG{n}{seasonal\PYGZus{}decompose}


\PYG{k}{def} \PYG{n+nf}{build\PYGZus{}plots}\PYG{p}{(}
        \PYG{n}{decomposed\PYGZus{}series}\PYG{p}{,}
        \PYG{n}{series\PYGZus{}name}\PYG{p}{:} \PYG{n+nb}{str}\PYG{p}{,}
        \PYG{n}{decomposer\PYGZus{}name}\PYG{p}{:} \PYG{n+nb}{str}\PYG{p}{,}
        \PYG{n}{\PYGZus{}palette}
\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{k+kc}{None}\PYG{p}{:}
    \PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{,} \PYG{n}{constrained\PYGZus{}layout}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

    \PYG{n}{decomposed\PYGZus{}series}\PYG{o}{.}\PYG{n}{observed}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{c}\PYG{o}{=}\PYG{n}{sns\PYGZus{}c}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set}\PYG{p}{(}\PYG{n}{title}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Observed Component}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{xlabel}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{decomposed\PYGZus{}series}\PYG{o}{.}\PYG{n}{trend}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{c}\PYG{o}{=}\PYG{n}{\PYGZus{}palette}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set}\PYG{p}{(}\PYG{n}{title}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Trend}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{xlabel}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{decomposed\PYGZus{}series}\PYG{o}{.}\PYG{n}{seasonal}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{c}\PYG{o}{=}\PYG{n}{\PYGZus{}palette}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set}\PYG{p}{(}\PYG{n}{title}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Seasonality}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{xlabel}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{decomposed\PYGZus{}series}\PYG{o}{.}\PYG{n}{resid}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{c}\PYG{o}{=}\PYG{n}{\PYGZus{}palette}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{ax}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set}\PYG{p}{(}\PYG{n}{title}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Residuals}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{xlabel}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{suptitle}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Daily Rentals in }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{series\PYGZus{}name}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{ \PYGZhy{} }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{decomposer\PYGZus{}name}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{p}{)}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}


\PYG{k}{def} \PYG{n+nf}{decompose\PYGZus{}series}\PYG{p}{(}
        \PYG{n}{data}\PYG{p}{:} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{,}
        \PYG{n}{col}\PYG{p}{:} \PYG{n+nb}{str}\PYG{p}{,}
        \PYG{n}{period}\PYG{p}{:} \PYG{n+nb}{int}\PYG{p}{,}
        \PYG{n}{mode}\PYG{p}{:} \PYG{n}{Optional}\PYG{p}{[}\PYG{n+nb}{str}\PYG{p}{]} \PYG{o}{=} \PYG{k+kc}{None}\PYG{p}{,}
        \PYG{n}{palette}\PYG{o}{=}\PYG{n}{sns}\PYG{o}{.}\PYG{n}{color\PYGZus{}palette}\PYG{p}{(}\PYG{n}{palette}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{deep}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{k+kc}{None}\PYG{p}{:}
    \PYG{k}{if} \PYG{n}{mode} \PYG{o+ow}{is} \PYG{k+kc}{None}\PYG{p}{:}
        \PYG{n}{\PYGZus{}model}\PYG{p}{:} \PYG{n+nb}{str} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{additive}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{elif} \PYG{n}{mode} \PYG{o+ow}{not} \PYG{o+ow}{in} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{additive}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{multiplicative}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{k+kc}{None}\PYG{p}{]}\PYG{p}{:}
        \PYG{k}{raise} \PYG{n+ne}{ValueError}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{mode}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{ must either be }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{additive}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{ (default value) or }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{multiplicative}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{\PYGZus{}model}\PYG{p}{:} \PYG{n+nb}{str} \PYG{o}{=} \PYG{n}{mode}

    \PYG{n}{decomposition} \PYG{o}{=} \PYG{n}{seasonal\PYGZus{}decompose}\PYG{p}{(}
        \PYG{n}{x}\PYG{o}{=}\PYG{n}{data}\PYG{p}{[}\PYG{n}{col}\PYG{p}{]}\PYG{p}{,}
        \PYG{n}{model}\PYG{o}{=}\PYG{n}{\PYGZus{}model}\PYG{p}{,}
        \PYG{n}{period}\PYG{o}{=}\PYG{n}{period}
    \PYG{p}{)}

    \PYG{n}{build\PYGZus{}plots}\PYG{p}{(}\PYG{n}{decomposition}\PYG{p}{,} \PYG{n}{col}\PYG{p}{,} \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{\PYGZus{}model}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{ Seasonal Decomposition }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{period} \PYG{l+s+si}{= \PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{palette}\PYG{p}{)}


\PYG{n}{daily\PYGZus{}rentals}\PYG{o}{.}\PYG{n}{pipe}\PYG{p}{(}\PYG{n}{decompose\PYGZus{}series}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Brera \PYGZhy{} 25}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{period}\PYG{o}{=}\PYG{l+m+mi}{7}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{05-time_series_analysis_16_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
From the observed component we can already spot the yearly patterns, which are outlined in the trended series. There are always two troughs: one in August and the other one during Christmas holidays and New Year’s Eve. There peak is always reached in May (and is preceded by a small dip around April and Easter holidays). Other two small dips can be observed around Carnival, in February (which is slightly longer and shifted, compared to the rest of Italy) and perhaps around Labour’s Day (May 1st) and the National Holiday on June 2nd. Then, the demand dips during the autumn too: at All Saint’s day (between Halloween and November 1st) and the city’s Patrons celebrations on December 9th (while December 8th is also a national holiday). This displays that predictable patterns such as holidays will indeed play a role in accruing the accuracy of the forecasts: after all, as outlined in the literature and from observing the patterns in the origin\sphinxhyphen{}destination matrix, docked bike\sphinxhyphen{}sharing services are strictly related to commuting patterns.

\sphinxAtStartPar
The overall series displays a growing trend from January to the peak in May, a plateau around June and July, then the great August dip and a gradual declining trend from September to the end of the year. These yearly patterns are basically the biggest sources of variation, and are what we aim to capture with daily aggregated data. The residuals appear clearly heteroskedastic, but perhaps stationary. The residual variance increases around April and October\sphinxhyphen{}November: we might guesstimate it is due to weather and rain conditions.

\sphinxAtStartPar
It is also worth noting the scales: seasonalities scales are very much in the negative range (on average, the seasonal decomposition sums up to 0), but is as much as half the range of values for residuals. It seems clear that this decomposition does not do a great job, as the unexplained component is much large.

\sphinxAtStartPar
As an exercise, we can change the \sphinxcode{\sphinxupquote{period}} of the data 30 days, as an exercise. This returns a much different seasonal pattern, which, however, is even less informative: the range of values is up to ten time smaller than the residuals. This also returns a much smoother linear trend, where the dips are less pronounced.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{05-time_series_analysis_18_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}

\subsection{Advanced Decomposition}
\label{\detokenize{05-time_series_analysis:advanced-decomposition}}
\sphinxAtStartPar
To investigate these patterns we can exploit more advanced decompostion patterns. Official tools are often developed by official bureaus, as seasonal decomposition is especially needed when dealing with monthly or quarterly data. Inside the European Union, the \sphinxhref{https://ec.europa.eu/eurostat/cros/content/software-jdemetra\_en}{official recommendation} is the JDemetra+ software library. The US Census Bureau implemented the X\sphinxhyphen{}11 category of models, which also allow the seasonal component to vary over time and are robust to outliers and missing values. These models, however, are not suited for daily and weekly data points (Hyndman \& Athanasopoulos, 2021).

\sphinxAtStartPar
For this reason, another technique is frequently used: STL decomposition, or Seasonal Trend decomposition using LOESS, proposed by Cleveland and his coauthors (Cleveland \& Devlin, 1988). LOESS is an acronym that unpacks to Locally Estimated Scatterplot Smoothing (or Savitzky\sphinxhyphen{}Golay filter), that indicates a non\sphinxhyphen{}parametric regression that is locally fitted. Simply put, the LOESS fits multiple, even polynomial regressions, “in a moving fashion analogous to how a moving average is computed for a time series” (Cleveland \& Devlin, 1988). \sphinxcode{\sphinxupquote{statsmodels}} implements the STL decomposition directly from the fortran library developed by Cleveland, and has a plethora of arguments to tweak. These can be split into three categories.

\sphinxAtStartPar
The main parameters are the following:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{endog}} is the data to be decomposed.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{period}} is the periodicity of the sequence. It is detected automatically if the data is provided as a Pandas \sphinxcode{\sphinxupquote{DataFrame}}. For example, if the data is monthly, the period is 12. In our case, since the data is daily, the period will be 7.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{seasonal}} is the length of the seasonal smoother and is set to 7 by default.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{trend}} is the length of the trend smoother. Must be an \sphinxstyleemphasis{odd} integer. If not provided uses the smallest odd integer greater than 1.5 * \sphinxcode{\sphinxupquote{period}} / (1 \sphinxhyphen{} 1.5 / \sphinxcode{\sphinxupquote{seasonal}})

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{low\_pass}} is the length of the low\sphinxhyphen{}pass filter used for each subseries. Must be an odd integer >=3. If not provided, uses the smallest odd integer greater than \sphinxcode{\sphinxupquote{period}}.

\end{itemize}

\sphinxAtStartPar
What this implies is that with STL decomposition we have a much greater control over the length of each smoother: we can look for a monthly trend and weekly seasonalities, for instance.

\sphinxAtStartPar
Then come the degrees parameters, i.e. whether to use a constant or a constant and trend. \sphinxcode{\sphinxupquote{0}} indicates that only the constant is used and \sphinxcode{\sphinxupquote{1}} also uses the trend. These values can be set with the parameters \sphinxcode{\sphinxupquote{seasonal\_degint}}, \sphinxcode{\sphinxupquote{trend\_degint}} and \sphinxcode{\sphinxupquote{low\_pass\_degint}}.

\sphinxAtStartPar
Lastly, there are the interpolation step parameters. Basically, they reduce the estimation time by interpolating values between an interval. If any \sphinxcode{\sphinxupquote{\_interpolation}} parameter is set to an integer greater than or equal to one, LOESS is used every number of points, while the skipped values are linearly interpolated. Interpolation can happen at the \sphinxcode{\sphinxupquote{seasonal}}, \sphinxcode{\sphinxupquote{trend}} and \sphinxcode{\sphinxupquote{low\_pass}} level.

\sphinxAtStartPar
The function also has a \sphinxcode{\sphinxupquote{robustbool}} flag, indicating whether to use a weighted version that is robust to some forms of outliers.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{05-time_series_analysis_20_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
The STL decomposition fits a much smoother trend, which we set to \sphinxcode{\sphinxupquote{31}} to capture the monthly variation. A higher figure, say yearly, would yield much smoother curves. It is immediate to notice that the seasonal patterns are dampened and vary across time quite significantly and display a much greater positive magnitude compared to the additive decomposition. Seasonal components shrink where the trend dips. The residuals also slightly improve: their variance becomes less hectic, because the STL better captures seasonality dynamics. However, high spikes remain.


\section{Correlation Analysis}
\label{\detokenize{05-time_series_analysis:correlation-analysis}}
\sphinxAtStartPar
Time series data is unique as the data points are not \(i.i.d.\) distributed. In other words, even if we can assume that the data comes from the same distribution (i.e., is \(i.d.\)), independence is not present. Data points are correlated across time: hence the definition \sphinxstyleemphasis{auto\sphinxhyphen{}correlation}. To explore time\sphinxhyphen{}dependencies structure, the auto\sphinxhyphen{}correlation function (ACF) and partial auto\sphinxhyphen{}correlation function (PACF) are used. We denote the sample autocorrelation at lag \(k\) by \(r_k\)
\begin{equation*}
\begin{split}r_k = \frac{\sum_{t=k+1}^T (y_t-\bar{y})(y_{t-k}-\bar{y})}{\sum_{t=1}^T (y_t-\bar{y})^2}\end{split}
\end{equation*}
\sphinxAtStartPar
However, the autocorrelation between to points at \(k\) lags of distance might simply be due both points being connected by the same “chain” of intermediate values \(y_{t-1}\) to \(y_{t-(k+1)}\), rather than because of any new information contained in  \(y_k\)  that could be used to forecast \(y_t\). This problem is solved via the PACF, which \sphinxhyphen{} simply put \sphinxhyphen{} estimates an autoregressive models (i.e., a linear regression fit only on the lags) and returns the coefficient of the \(k\)th component.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
[]
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{05-time_series_analysis_22_1}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
The plots indicate a strong auto\sphinxhyphen{}regressive component: basically all values in the week before are significant and the autocorrelations corresponding to the seasonal periodicities (approximately one week before) are all significant still one month later. The partial autocorrelation function drops to non\sphinxhyphen{}significant levels quite sooner but appear to still be significant around the seasonal components.


\section{Differencing}
\label{\detokenize{05-time_series_analysis:differencing}}
\sphinxAtStartPar
Differencing is the last step in our time series analysis. Given that the time series display seasonality, by definition they are non\sphinxhyphen{}stationary. Stationarity is a property that has two formulations. In its \sphinxstyleemphasis{strong} formulation, a time series \(\{y_t\}\) is stationary if, for any \(s\), the distribution of \((y_t,... y_{t+s})\) does not depend on \(s\). This property is difficult to observe in economic terms \sphinxhyphen{} but can be observed in the realm of physics, like the swing of a (frictionless) pendulum: no matter the time, its properties like amplitude and period remain the same. For this reason, we settle with \sphinxstyleemphasis{weakly stationarity}, and time series that display this property are also called \sphinxstyleemphasis{wide\sphinxhyphen{}sense stationary}, \sphinxstyleemphasis{covariance stationary}, or \sphinxstyleemphasis{second order stationary} processes.

\sphinxAtStartPar
As the name suggests, these processes have first and second\sphinxhyphen{}order moments that are fixed in time; the same applies to auto\sphinxhyphen{}correlation, that should only depend on the length of the lag \(k\), i.e. should be the same across any two time points at distance \(k\). These two properties do not imply each other, unless when the underlying process is Gaussian. Our data does not seem unequivocably normal:

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{05-time_series_analysis_25_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
To transform a non\sphinxhyphen{}stationary series into a (weakly) stationary one, the principal tool is taking differences, i.e. subtracting from every \(y_t\) the \(k\)\sphinxhyphen{}th lagged value. Usually, however, the differences that are preferred are the ones that are interpretable: first differences represent the change between two observations, and the seasonal differences represent the increase from one seasonal period to the other (in this case, between two weeks).

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{05-time_series_analysis_27_0}.png}

\noindent\sphinxincludegraphics{{05-time_series_analysis_27_1}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
First differencing returns seemingly stationary data, but the seasonal component is not removed. On the contrary, the seasonal differences are less noisy. Still, the two datasets display high variance, with a change as great as 400 observations. We can also difference the series twice; this, however, might not be recommendable if the series is already stationary after one round of differencing: “applying more differences than required will induce false dynamics or autocorrelations that do not really exist in the time series” (Hyndman \& Athanasopoulos, 2021). At first glance, double differences seem to return a series that is more convincingly stationary.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{05-time_series_analysis_29_0}.png}

\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}

\subsection{Testing for Stationarity}
\label{\detokenize{05-time_series_analysis:testing-for-stationarity}}
\sphinxAtStartPar
Stationarity can be assessed more objectively using a particular category of statistical tests named \sphinxstyleemphasis{unit root tests}. Simply put,

\sphinxAtStartPar
One of the most popular unit root tests is the \sphinxstyleemphasis{Kwiatkowski\sphinxhyphen{}Phillips\sphinxhyphen{}Schmidt\sphinxhyphen{}Shin (KPSS) test} (Kwiatkowski et al., 1992). With the authors’ words, the null hypothesis is that “an observable series is stationary around a deterministic trend”, against the alternative that “the series is difference\sphinxhyphen{}stationary”, i.e. requires differencing. In other words, the test’s null hypothesis is that the process is level or trend stationary (i.e., does not exhibit a trend) and if we reject the null hypothesis (for \(p\) values smaller than \(0.05\)) differencing is required.

\sphinxAtStartPar
Another test is the (Augmented) Dickey\sphinxhyphen{}Fuller or ADF test (Dickey \& Fuller, 2012). While the KPSS test’s null hypothesis is that the series is already stationary, the ADF test assumes the opposite, i.e. the series is not stationary because it has a unit root. If we reject the null, we assume the time series to be stationary. Both tests suggest that data from \sphinxcode{\sphinxupquote{Brera \sphinxhyphen{} 25}} is compatible with the hypothesis that the series is stationary, by taking either first order differences, seasonal differences (and the combination of both). For this reason, we shall stick to seasonal differences.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{statsmodels}\PYG{n+nn}{.}\PYG{n+nn}{tsa}\PYG{n+nn}{.}\PYG{n+nn}{stattools} \PYG{k+kn}{import} \PYG{n}{adfuller}\PYG{p}{,} \PYG{n}{kpss}


\PYG{k}{def} \PYG{n+nf}{stationarity\PYGZus{}test}\PYG{p}{(}\PYG{n}{lagged\PYGZus{}series}\PYG{p}{)} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZgt{}} \PYG{k+kc}{None}\PYG{p}{:}
    \PYG{k}{with} \PYG{n}{warnings}\PYG{o}{.}\PYG{n}{catch\PYGZus{}warnings}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{warnings}\PYG{o}{.}\PYG{n}{filterwarnings}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ignore}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

        \PYG{n}{adfuller\PYGZus{}results} \PYG{o}{=} \PYG{n}{adfuller}\PYG{p}{(}
            \PYG{c+c1}{\PYGZsh{} take seasonal diffs and drop the 7 missing values}
            \PYG{n}{lagged\PYGZus{}series}\PYG{o}{.}\PYG{n}{dropna}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
            \PYG{n}{regression}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ct}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{p}{)}

        \PYG{n}{kpss\PYGZus{}results} \PYG{o}{=} \PYG{n}{kpss}\PYG{p}{(}
            \PYG{n}{lagged\PYGZus{}series}\PYG{o}{.}\PYG{n}{dropna}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
            \PYG{n}{regression}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ct}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{n}{nlags}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{auto}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{p}{)}

        \PYG{n}{console}\PYG{o}{.}\PYG{n}{print}\PYG{p}{(}
            \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ADF test statistic: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{adfuller\PYGZus{}results}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{l+s+si}{:}\PYG{l+s+s2}{.3}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{ ADF p\PYGZhy{}value: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{adfuller\PYGZus{}results}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{l+s+si}{:}\PYG{l+s+s2}{.3\PYGZpc{}}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{:}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}
            \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{there is no unit root \PYGZhy{} the series *is* stationary}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{n}{adfuller\PYGZus{}results}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZlt{}} \PYG{l+m+mf}{0.05} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{there is a unit root \PYGZhy{} the series *is not* stationary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}
            \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{KPSS test statistic: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{kpss\PYGZus{}results}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{l+s+si}{:}\PYG{l+s+s2}{.3}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{ KPSS p\PYGZhy{}value: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{kpss\PYGZus{}results}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{l+s+si}{:}\PYG{l+s+s2}{.3\PYGZpc{}}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{:}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}
            \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{there is a unit root \PYGZhy{} the series *is not* stationary}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{n}{kpss\PYGZus{}results}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZlt{}} \PYG{l+m+mf}{0.05} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{there is no unit root \PYGZhy{} the series *is* stationary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{p}{)}


\PYG{n}{console}\PYG{o}{.}\PYG{n}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{First Order Differences (Lag: 1)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{daily\PYGZus{}rentals}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Brera \PYGZhy{} 25}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{diff}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{pipe}\PYG{p}{(}\PYG{n}{stationarity\PYGZus{}test}\PYG{p}{)}
\PYG{n}{console}\PYG{o}{.}\PYG{n}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Seasonal Differences (Lag: 7)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{daily\PYGZus{}rentals}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Brera \PYGZhy{} 25}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{diff}\PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{)}\PYG{o}{.}\PYG{n}{pipe}\PYG{p}{(}\PYG{n}{stationarity\PYGZus{}test}\PYG{p}{)}
\PYG{n}{console}\PYG{o}{.}\PYG{n}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Double Differences (Lag: 7 and 1)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{daily\PYGZus{}rentals}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Brera \PYGZhy{} 25}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{diff}\PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{)}\PYG{o}{.}\PYG{n}{diff}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{pipe}\PYG{p}{(}\PYG{n}{stationarity\PYGZus{}test}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
First Order Differences \PYG{Color+ColorBold}{(}Lag: \PYG{Color+ColorBold+ColorBoldCyan}{1}\PYG{Color+ColorBold}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
ADF test statistic: \PYG{Color+ColorBold+ColorBoldCyan}{\PYGZhy{}9.08} ADF p\PYGZhy{}value: \PYG{Color+ColorBold+ColorBoldCyan}{0.000}\PYGZpc{}:
there is no unit root \PYGZhy{} the series *is* stationary

KPSS test statistic: \PYG{Color+ColorBold+ColorBoldCyan}{0.06} KPSS p\PYGZhy{}value: \PYG{Color+ColorBold+ColorBoldCyan}{10.000}\PYGZpc{}:
there is no unit root \PYGZhy{} the series *is* stationary
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Seasonal Differences \PYG{Color+ColorBold}{(}Lag: \PYG{Color+ColorBold+ColorBoldCyan}{7}\PYG{Color+ColorBold}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
ADF test statistic: \PYG{Color+ColorBold+ColorBoldCyan}{\PYGZhy{}7.9} ADF p\PYGZhy{}value: \PYG{Color+ColorBold+ColorBoldCyan}{0.000}\PYGZpc{}:
there is no unit root \PYGZhy{} the series *is* stationary

KPSS test statistic: \PYG{Color+ColorBold+ColorBoldCyan}{0.012} KPSS p\PYGZhy{}value: \PYG{Color+ColorBold+ColorBoldCyan}{10.000}\PYGZpc{}:
there is no unit root \PYGZhy{} the series *is* stationary
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Double Differences \PYG{Color+ColorBold}{(}Lag: \PYG{Color+ColorBold+ColorBoldCyan}{7} and \PYG{Color+ColorBold+ColorBoldCyan}{1}\PYG{Color+ColorBold}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
ADF test statistic: \PYG{Color+ColorBold+ColorBoldCyan}{\PYGZhy{}12.5} ADF p\PYGZhy{}value: \PYG{Color+ColorBold+ColorBoldCyan}{0.000}\PYGZpc{}:
there is no unit root \PYGZhy{} the series *is* stationary

KPSS test statistic: \PYG{Color+ColorBold+ColorBoldCyan}{0.0509} KPSS p\PYGZhy{}value: \PYG{Color+ColorBold+ColorBoldCyan}{10.000}\PYGZpc{}:
there is no unit root \PYGZhy{} the series *is* stationary
\end{sphinxVerbatim}

\end{sphinxuseclass}
\end{sphinxuseclass}

\chapter{References}
\label{\detokenize{references:references}}\label{\detokenize{references::doc}}

\section{Chapter 1}
\label{\detokenize{references:chapter-1}}
\sphinxAtStartPar
Bahmanyar, A., Estebsari, A., \& Ernst, D. (2020). The impact of different COVID\sphinxhyphen{}19 containment measures on electricity consumption in Europe. \sphinxstyleemphasis{Energy Research \& Social Science}, \sphinxstyleemphasis{68}, 101683. https://doi.org/10.1016/j.erss.2020.101683

\sphinxAtStartPar
Bergantino, A. S., Intini, M., \& Tangari, L. (2021). Influencing factors for potential bike\sphinxhyphen{}sharing users: an empirical analysis during the COVID\sphinxhyphen{}19 pandemic. \sphinxstyleemphasis{Research in Transportation Economics}, \sphinxstyleemphasis{86}, 101028. https://doi.org/10.1016/j.retrec.2020.101028

\sphinxAtStartPar
Bordagaray, M., dell’Olio, L., Fonzone, A., \& Ibeas, Á. (2016). Capturing the conditions that introduce systematic variation in bike\sphinxhyphen{}sharing travel behavior using data mining techniques. \sphinxstyleemphasis{Transportation Research Part C: Emerging Technologies}, \sphinxstyleemphasis{71}, 231–248. https://doi.org/10.1016/j.trc.2016.07.009

\sphinxAtStartPar
Cantelmo, G., Kucharski, R., \& Antoniou, C. (2020). Low\sphinxhyphen{}Dimensional Model for Bike\sphinxhyphen{}Sharing Demand Forecasting that Explicitly Accounts for Weather Data. \sphinxstyleemphasis{Transportation Research Record}, \sphinxstyleemphasis{2674}(8), 132–144. https://doi.org/10.1177/0361198120932160

\sphinxAtStartPar
Che aria respiriamo. (2021, September 28). \sphinxstyleemphasis{Il Post}. https://www.ilpost.it/2021/09/28/qualita\sphinxhyphen{}aria\sphinxhyphen{}inquinanti\sphinxhyphen{}oms/

\sphinxAtStartPar
\sphinxstyleemphasis{Dall’andamento degli obiettivi di sviluppo sostenibile alla mobilità}. (2021, September 8). https://www.istat.it/it/archivio/260839

\sphinxAtStartPar
Eren, E., \& Uz, V. E. (2020). A review on bike\sphinxhyphen{}sharing: The factors affecting bike\sphinxhyphen{}sharing demand. \sphinxstyleemphasis{Sustainable Cities and Society}, \sphinxstyleemphasis{54}, 101882. https://doi.org/10.1016/j.scs.2019.101882

\sphinxAtStartPar
\sphinxstyleemphasis{European city air quality viewer — European Environment Agency}. (2021, June 17). {[}Dashboard (Tableau){]}. https://www.eea.europa.eu/themes/air/urban\sphinxhyphen{}air\sphinxhyphen{}quality/european\sphinxhyphen{}city\sphinxhyphen{}air\sphinxhyphen{}quality\sphinxhyphen{}viewer

\sphinxAtStartPar
Executable Books Community. (2020). \sphinxstyleemphasis{Jupyter Book} (v0.10) {[}Computer software{]}. Zenodo. https://doi.org/10.5281/ZENODO.2561065

\sphinxAtStartPar
Fricker, C., \& Gast, N. (2016). Incentives and redistribution in homogeneous bike\sphinxhyphen{}sharing systems with stations of finite capacity. \sphinxstyleemphasis{EURO Journal on Transportation and Logistics}, \sphinxstyleemphasis{5}(3), 261–291. https://doi.org/10.1007/s13676\sphinxhyphen{}014\sphinxhyphen{}0053\sphinxhyphen{}5

\sphinxAtStartPar
Ghosh, S., Koh, J. Y., \& Jaillet, P. (2019). Improving Customer Satisfaction in Bike Sharing Systems through Dynamic Repositioning. \sphinxstyleemphasis{MIT Web Domain}. https://dspace.mit.edu/handle/1721.1/128925

\sphinxAtStartPar
\sphinxstyleemphasis{Gli spostamenti per motivi di studio o lavoro nel 2019 secondo il Censimento permanente della popolazione}. (2021, May 13). https://www.istat.it/it/archivio/257621

\sphinxAtStartPar
Gualtieri, G., Brilli, L., Carotenuto, F., Vagnoli, C., Zaldei, A., \& Gioli, B. (2020). Quantifying road traffic impact on air quality in urban areas: A Covid19\sphinxhyphen{}induced lockdown analysis in Italy. \sphinxstyleemphasis{Environmental Pollution}, \sphinxstyleemphasis{267}, 115682. https://doi.org/10.1016/j.envpol.2020.115682

\sphinxAtStartPar
Hamad, S. Y. Y., Ma, T., \& Antoniou, C. (2021). Analysis and Prediction of Bikesharing Traffic Flow – Citi Bike, New York. \sphinxstyleemphasis{2021 7th International Conference on Models and Technologies for Intelligent Transportation Systems (MT\sphinxhyphen{}ITS)}, 1–8. https://doi.org/10.1109/MT\sphinxhyphen{}ITS49943.2021.9529290

\sphinxAtStartPar
Härmand, K. (2021). Digitalisation before and after the Covid\sphinxhyphen{}19 crisis. \sphinxstyleemphasis{ERA Forum}, \sphinxstyleemphasis{22}(1), 39–50. https://doi.org/10.1007/s12027\sphinxhyphen{}021\sphinxhyphen{}00656\sphinxhyphen{}8

\sphinxAtStartPar
\sphinxstyleemphasis{Italy \sphinxhyphen{} Air pollution country fact sheet — European Environment Agency}. (2020, November 23). {[}Dashboard (Tableau){]}. https://www.eea.europa.eu/themes/air/country\sphinxhyphen{}fact\sphinxhyphen{}sheets/2020\sphinxhyphen{}country\sphinxhyphen{}fact\sphinxhyphen{}sheets/italy

\sphinxAtStartPar
Jephcote, C., Hansell, A. L., Adams, K., \& Gulliver, J. (2021). Changes in air quality during COVID\sphinxhyphen{}19 ‘lockdown’ in the United Kingdom. \sphinxstyleemphasis{Environmental Pollution}, \sphinxstyleemphasis{272}, 116011. https://doi.org/10.1016/j.envpol.2020.116011

\sphinxAtStartPar
Ke, J., Zheng, H., Yang, H., \& Chen, X. (Michael). (2017). Short\sphinxhyphen{}term forecasting of passenger demand under on\sphinxhyphen{}demand ride services: A spatio\sphinxhyphen{}temporal deep learning approach. \sphinxstyleemphasis{Transportation Research Part C: Emerging Technologies}, \sphinxstyleemphasis{85}, 591–608. https://doi.org/10.1016/j.trc.2017.10.016

\sphinxAtStartPar
Lian, X., Huang, J., Huang, R., Liu, C., Wang, L., \& Zhang, T. (2020). Impact of city lockdown on the air quality of COVID\sphinxhyphen{}19\sphinxhyphen{}hit of Wuhan city. \sphinxstyleemphasis{Science of The Total Environment}, \sphinxstyleemphasis{742}, 140556. https://doi.org/10.1016/j.scitotenv.2020.140556

\sphinxAtStartPar
\sphinxstyleemphasis{Milano ha un’occasione storica}. (2017, April 9). Il Post. http://www.ilpost.it/2017/04/09/scali\sphinxhyphen{}ferroviari\sphinxhyphen{}milano/

\sphinxAtStartPar
Pal, A., \& Zhang, Y. (2017). Free\sphinxhyphen{}floating bike sharing: Solving real\sphinxhyphen{}life large\sphinxhyphen{}scale static rebalancing problems. \sphinxstyleemphasis{Transportation Research Part C: Emerging Technologies}, \sphinxstyleemphasis{80}, 92–116. https://doi.org/10.1016/j.trc.2017.03.016

\sphinxAtStartPar
\sphinxstyleemphasis{Pandoc \sphinxhyphen{} About pandoc}. (n.d.). Retrieved October 23, 2021, from https://pandoc.org/

\sphinxAtStartPar
Perkel, J. M. (2018). Why Jupyter is data scientists’ computational notebook of choice. \sphinxstyleemphasis{Nature}, \sphinxstyleemphasis{563}(7729), 145–146. https://doi.org/10.1038/d41586\sphinxhyphen{}018\sphinxhyphen{}07196\sphinxhyphen{}1

\sphinxAtStartPar
Romer, P. (2018, April 13). \sphinxstyleemphasis{Jupyter, Mathematica, and the Future of the Research Paper}. Paul Romer. https://paulromer.net/jupyter\sphinxhyphen{}mathematica\sphinxhyphen{}and\sphinxhyphen{}the\sphinxhyphen{}future\sphinxhyphen{}of\sphinxhyphen{}the\sphinxhyphen{}research\sphinxhyphen{}paper/index.html

\sphinxAtStartPar
Singh, R. P., \& Chauhan, A. (2020). Impact of lockdown on air quality in India during COVID\sphinxhyphen{}19 pandemic. \sphinxstyleemphasis{Air Quality, Atmosphere \& Health}, \sphinxstyleemphasis{13}(8), 921–928. https://doi.org/10.1007/s11869\sphinxhyphen{}020\sphinxhyphen{}00863\sphinxhyphen{}1

\sphinxAtStartPar
Somers, J. (2018, April 5). \sphinxstyleemphasis{The Scientific Paper Is Obsolete}. The Atlantic. https://www.theatlantic.com/science/archive/2018/04/the\sphinxhyphen{}scientific\sphinxhyphen{}paper\sphinxhyphen{}is\sphinxhyphen{}obsolete/556676/

\sphinxAtStartPar
\sphinxstyleemphasis{Spostamenti quotidiani e nuove forme di mobilità}. (2019, February 4). https://www.istat.it/it/archivio/224469

\sphinxAtStartPar
\sphinxstyleemphasis{Standards \sphinxhyphen{} Air Quality \sphinxhyphen{} Environment \sphinxhyphen{} European Commission}. (n.d.). Retrieved October 10, 2021, from https://ec.europa.eu/environment/air/quality/standards.htm

\sphinxAtStartPar
\sphinxstyleemphasis{The 17 Goals}. (n.d.). Retrieved October 10, 2021, from https://sdgs.un.org/goals

\sphinxAtStartPar
Tian, Y., Zhang, X., Yang, B., Wang, J., \& An, S. (2021). An individual\sphinxhyphen{}based spatio\sphinxhyphen{}temporal travel demand mining method and its application in improving rebalancing for free\sphinxhyphen{}floating bike\sphinxhyphen{}sharing system. \sphinxstyleemphasis{Advanced Engineering Informatics}, \sphinxstyleemphasis{50}, 101365. https://doi.org/10.1016/j.aei.2021.101365

\sphinxAtStartPar
Truant, E., Broccardo, L., \& Dana, L.\sphinxhyphen{}P. (2021). Digitalisation boosts company performance: an overview of Italian listed companies. \sphinxstyleemphasis{Technological Forecasting and Social Change}, \sphinxstyleemphasis{173}, 121173. https://doi.org/10.1016/j.techfore.2021.121173

\sphinxAtStartPar
\sphinxstyleemphasis{Un po’ di cose notevoli dentro il PNRR}. (2021, April 27). Il Post. http://www.ilpost.it/2021/04/27/pnrr\sphinxhyphen{}cosa\sphinxhyphen{}ce\sphinxhyphen{}dentro/

\sphinxAtStartPar
Xu, C., Ji, J., \& Liu, P. (2018). The station\sphinxhyphen{}free sharing bike demand forecasting with a deep learning approach and large\sphinxhyphen{}scale datasets. \sphinxstyleemphasis{Transportation Research Part C: Emerging Technologies}, \sphinxstyleemphasis{95}, 47–60. https://doi.org/10.1016/j.trc.2018.07.013

\sphinxAtStartPar
\sphinxstyleemphasis{Zotero | Your personal research assistant}. (n.d.). Retrieved October 24, 2021, from https://www.zotero.org/start


\section{Chapter 2}
\label{\detokenize{references:chapter-2}}
\sphinxAtStartPar
Airbnb urges housing reform in Berlin after court overturns permit rejection. (2017, September 8). \sphinxstyleemphasis{Tech Crunch}. https://techcrunch.com/2017/09/08/airbnb\sphinxhyphen{}urges\sphinxhyphen{}housing\sphinxhyphen{}reform\sphinxhyphen{}in\sphinxhyphen{}berlin\sphinxhyphen{}after\sphinxhyphen{}court\sphinxhyphen{}overturns\sphinxhyphen{}permit\sphinxhyphen{}rejection/

\sphinxAtStartPar
\sphinxstyleemphasis{Bike Sharing \sphinxhyphen{} Comune di Milano}. (2021, August 5). https://www.comune.milano.it/servizi/bike\sphinxhyphen{}sharing

\sphinxAtStartPar
Cappozzo, A., Greselin, F., \& Manzi, G. (n.d.). \sphinxstyleemphasis{Predicting and improving smart mobility: a robust model\sphinxhyphen{}based approach to the BikeMi BSS}. 6.

\sphinxAtStartPar
Croci, E., \& Rossi, D. (2014). \sphinxstyleemphasis{Optimizing the Position of Bike Sharing Stations. The Milan Case.} (SSRN Scholarly Paper ID 2461179). Social Science Research Network. https://doi.org/10.2139/ssrn.2461179

\sphinxAtStartPar
DeMaio, P. (2009). Bike\sphinxhyphen{}sharing: History, Impacts, Models of Provision, and Future. \sphinxstyleemphasis{Journal of Public Transportation}, \sphinxstyleemphasis{12}(4). https://doi.org/http://doi.org/10.5038/2375\sphinxhyphen{}0901.12.4.3

\sphinxAtStartPar
Fishman, E. (2015). Bikeshare: A Review of Recent Literature. \sphinxstyleemphasis{Transport Reviews}. https://www.tandfonline.com/doi/abs/10.1080/01441647.2015.1033036

\sphinxAtStartPar
Goggin, B., \& Taylor, K. (2019, May 10). \sphinxstyleemphasis{49 of the biggest scandals in Uber’s history}. Business Insider. https://www.businessinsider.com/uber\sphinxhyphen{}company\sphinxhyphen{}scandals\sphinxhyphen{}and\sphinxhyphen{}controversies\sphinxhyphen{}2017\sphinxhyphen{}11

\sphinxAtStartPar
In Cina vivere senza WeChat è complicato. (2018, June 30). \sphinxstyleemphasis{Il Post}. http://www.ilpost.it/2018/06/30/cina\sphinxhyphen{}wechat/

\sphinxAtStartPar
Jackson, A. (2021, September 19). \sphinxstyleemphasis{The Story of Uber}. Investopedia. https://www.investopedia.com/articles/personal\sphinxhyphen{}finance/111015/story\sphinxhyphen{}uber.asp

\sphinxAtStartPar
La crisi della sharing economy. (2020, May 3). \sphinxstyleemphasis{Il Post}. http://www.ilpost.it/2020/05/03/sharing\sphinxhyphen{}economy\sphinxhyphen{}crisi\sphinxhyphen{}coronavirus/

\sphinxAtStartPar
La nuova sentenza europea sugli affitti brevi. (2020, September 23). \sphinxstyleemphasis{Il Post}. http://www.ilpost.it/2020/09/23/airbnb\sphinxhyphen{}affitti\sphinxhyphen{}brevi\sphinxhyphen{}sentenza\sphinxhyphen{}corte\sphinxhyphen{}giustizia\sphinxhyphen{}europea/

\sphinxAtStartPar
La quotazione in borsa di Airbnb è stata un successo. (2020, December 10). \sphinxstyleemphasis{Il Post}. http://www.ilpost.it/2020/12/10/airbnb\sphinxhyphen{}quotazione\sphinxhyphen{}azioni/

\sphinxAtStartPar
Laa, B., \& Leth, U. (2020). Survey of E\sphinxhyphen{}scooter users in Vienna: Who they are and how they ride. \sphinxstyleemphasis{Journal of Transport Geography}, \sphinxstyleemphasis{89}, 102874. https://doi.org/10.1016/j.jtrangeo.2020.102874

\sphinxAtStartPar
Le città europee contro gli affitti brevi. (2021, April 21). \sphinxstyleemphasis{Il Post}. http://www.ilpost.it/2021/04/21/citta\sphinxhyphen{}europee\sphinxhyphen{}affitti\sphinxhyphen{}breve\sphinxhyphen{}termine/

\sphinxAtStartPar
Ma, Y., Lan, J., Thornton, T., Mangalagiu, D., \& Zhu, D. (2018). Challenges of collaborative governance in the sharing economy: The case of free\sphinxhyphen{}floating bike sharing in Shanghai. \sphinxstyleemphasis{Journal of Cleaner Production}, \sphinxstyleemphasis{197}, 356–365. https://doi.org/10.1016/j.jclepro.2018.06.213

\sphinxAtStartPar
Magnani, A. (2017, November 27). \sphinxstyleemphasis{La guerra del bike\sphinxhyphen{}sharing: così le bici cinesi low cost «invadono» il mercato italiano}. Il Sole 24 ORE. https://www.ilsole24ore.com/art/la\sphinxhyphen{}guerra\sphinxhyphen{}bike\sphinxhyphen{}sharing\sphinxhyphen{}cosi\sphinxhyphen{}bici\sphinxhyphen{}cinesi\sphinxhyphen{}low\sphinxhyphen{}cost\sphinxhyphen{}invadono\sphinxhyphen{}mercato\sphinxhyphen{}italiano\sphinxhyphen{}AEfgqkID

\sphinxAtStartPar
Mitra, R., \& Hess, P. M. (2021). Who are the potential users of shared e\sphinxhyphen{}scooters? An examination of socio\sphinxhyphen{}demographic, attitudinal and environmental factors. \sphinxstyleemphasis{Travel Behaviour and Society}, \sphinxstyleemphasis{23}, 100–107. https://doi.org/10.1016/j.tbs.2020.12.004

\sphinxAtStartPar
\sphinxstyleemphasis{Monopattini in Sharing \sphinxhyphen{} Comune di Milano}. (2021, July 7). https://www.comune.milano.it/servizi/monopattini\sphinxhyphen{}in\sphinxhyphen{}sharing

\sphinxAtStartPar
Moreau, H., de Jamblinne de Meux, L., Zeller, V., D’Ans, P., Ruwet, C., \& Achten, W. M. J. (2020). Dockless E\sphinxhyphen{}Scooter: A Green Solution for Mobility? Comparative Case Study between Dockless E\sphinxhyphen{}Scooters, Displaced Transport, and Personal E\sphinxhyphen{}Scooters. \sphinxstyleemphasis{Sustainability}, \sphinxstyleemphasis{12}(5), 1803. https://doi.org/10.3390/su12051803

\sphinxAtStartPar
Nel primo giorno di quotazione in borsa, le azioni di Uber hanno perso il 7,6 per cento. (2019, May 11). \sphinxstyleemphasis{Il Post}. http://www.ilpost.it/2019/05/11/uber\sphinxhyphen{}azioni/

\sphinxAtStartPar
Nikiforiadis, A., Paschalidis, E., Stamatiadis, N., Raptopoulou, A., Kostareli, A., \& Basbas, S. (2021). Analysis of attitudes and engagement of shared e\sphinxhyphen{}scooter users. \sphinxstyleemphasis{Transportation Research Part D: Transport and Environment}, \sphinxstyleemphasis{94}, 102790. https://doi.org/10.1016/j.trd.2021.102790

\sphinxAtStartPar
Parkes, S. D., Marsden, G., Shaheen, S. A., \& Cohen, A. P. (2013). Understanding the diffusion of public bikesharing systems: evidence from Europe and North America. \sphinxstyleemphasis{Journal of Transport Geography}, \sphinxstyleemphasis{31}, 94–103. https://doi.org/10.1016/j.jtrangeo.2013.06.003

\sphinxAtStartPar
P.Sol. (2017, July 25). \sphinxstyleemphasis{Bike sharing senza parcheggi: chi è il colosso cinese che sbarca in Italia}. Il Sole 24 ORE. https://www.ilsole24ore.com/art/bike\sphinxhyphen{}sharing\sphinxhyphen{}senza\sphinxhyphen{}parcheggi\sphinxhyphen{}chi\sphinxhyphen{}e\sphinxhyphen{}colosso\sphinxhyphen{}cinese\sphinxhyphen{}che\sphinxhyphen{}sbarca\sphinxhyphen{}italia\sphinxhyphen{}AEjzmr2B

\sphinxAtStartPar
Reck, D. J., \& Axhausen, K. W. (2021). Who uses shared micro\sphinxhyphen{}mobility services? Empirical evidence from Zurich, Switzerland. \sphinxstyleemphasis{Transportation Research Part D: Transport and Environment}, \sphinxstyleemphasis{94}, 102803. https://doi.org/10.1016/j.trd.2021.102803

\sphinxAtStartPar
Reck, D. J., Haitao, H., Guidon, S., \& Axhausen, K. W. (2021). Explaining shared micromobility usage, competition and mode choice by modelling empirical data from Zurich, Switzerland. \sphinxstyleemphasis{Transportation Research Part C: Emerging Technologies}, \sphinxstyleemphasis{124}, 102947. https://doi.org/10.1016/j.trc.2020.102947

\sphinxAtStartPar
Saibene, G., \& Manzi, G. (2015). \sphinxstyleemphasis{Bike Usage in Public Bike\sphinxhyphen{}Sharing: An Analysis of the “BikeMi” System in Milan}. 21. https://air.unimi.it/handle/2434/515293

\sphinxAtStartPar
Salvioli, L. (2018, December 19). \sphinxstyleemphasis{Ofo vicina al fallimento, Mobike verso la vendita in Europa}. Il Sole 24 ORE. https://www.ilsole24ore.com/art/ofo\sphinxhyphen{}vicina\sphinxhyphen{}fallimento\sphinxhyphen{}mobike\sphinxhyphen{}la\sphinxhyphen{}vendita\sphinxhyphen{}europa\sphinxhyphen{}AEEdWb2G

\sphinxAtStartPar
Sanders, R. L., Branion\sphinxhyphen{}Calles, M., \& Nelson, T. A. (2020). To scoot or not to scoot: Findings from a recent survey about the benefits and barriers of using E\sphinxhyphen{}scooters for riders and non\sphinxhyphen{}riders. \sphinxstyleemphasis{Transportation Research Part A: Policy and Practice}, \sphinxstyleemphasis{139}, 217–227. https://doi.org/10.1016/j.tra.2020.07.009

\sphinxAtStartPar
Schmidt, C. (2018). Active Travel for All? The Surge in Public Bike\sphinxhyphen{}Sharing Programs. \sphinxstyleemphasis{Environmental Health Perspectives}, \sphinxstyleemphasis{126}(8), 082001. https://doi.org/10.1289/EHP3754

\sphinxAtStartPar
\sphinxstyleemphasis{Seattle ha imposto una paga minima per gli autisti di Uber e Lyft}. (2020, September 30). Il Post. http://www.ilpost.it/2020/09/30/seattle\sphinxhyphen{}paga\sphinxhyphen{}minima\sphinxhyphen{}autisti\sphinxhyphen{}uber/

\sphinxAtStartPar
\sphinxstyleemphasis{Secondo la procura di Milano, Uber Eats, Glovo, Deliveroo e Just Eat devono regolarizzare 60mila rider con contratti di collaborazione}. (2021, February 24). Il Post. http://www.ilpost.it/2021/02/24/procura\sphinxhyphen{}uber\sphinxhyphen{}eats\sphinxhyphen{}glovo\sphinxhyphen{}deliveroo\sphinxhyphen{}just\sphinxhyphen{}eat\sphinxhyphen{}regolarizzare\sphinxhyphen{}rider/

\sphinxAtStartPar
Soldavini, P. (2019, November 8). \sphinxstyleemphasis{Il bike sharing europeo di Mobike diventa italiano (ed elettrico)}. Il Sole 24 ORE. https://www.ilsole24ore.com/art/bike\sphinxhyphen{}sharing\sphinxhyphen{}italiana\sphinxhyphen{}idri\sphinxhyphen{}bk\sphinxhyphen{}rileva\sphinxhyphen{}attivita\sphinxhyphen{}ue\sphinxhyphen{}mobike\sphinxhyphen{}ACJxRbx

\sphinxAtStartPar
Sorrentino, M., Manzi, G., \& Virili, F. (2019). \sphinxstyleemphasis{Public and private dimensions in the identity\sphinxhyphen{}mission nexus: the BikeMi case}. https://doi.org/10.15167/1824\sphinxhyphen{}3576/IPEJM2019.1.1191

\sphinxAtStartPar
Stone, B. (2017, January 26). The \$99 Billion Idea: How Uber and Airbnb Won. \sphinxstyleemphasis{Bloomberg Businessweek}. https://www.bloomberg.com/features/2017\sphinxhyphen{}uber\sphinxhyphen{}airbnb\sphinxhyphen{}99\sphinxhyphen{}billion\sphinxhyphen{}idea/

\sphinxAtStartPar
Toro, J. F., Carrion, D., Brovelli, M. A., \& Percoco, M. (2020). BikeMi Bike\sphinxhyphen{}Sharing Service Exploratory Analysis on Mobility Patterns. \sphinxstyleemphasis{The International Archives of the Photogrammetry, Remote Sensing and Spatial Information Sciences}, \sphinxstyleemphasis{XLIII\sphinxhyphen{}B4\sphinxhyphen{}2020}, 197–203. https://doi.org/10.5194/isprs\sphinxhyphen{}archives\sphinxhyphen{}XLIII\sphinxhyphen{}B4\sphinxhyphen{}2020\sphinxhyphen{}197\sphinxhyphen{}2020

\sphinxAtStartPar
Tuncer, S., Laurier, E., Brown, B., \& Licoppe, C. (2020). Notes on the practices and appearances of e\sphinxhyphen{}scooter users in public space. \sphinxstyleemphasis{Journal of Transport Geography}, \sphinxstyleemphasis{85}, 102702. https://doi.org/10.1016/j.jtrangeo.2020.102702

\sphinxAtStartPar
\sphinxstyleemphasis{Uber Italia è accusata di sfruttamento dei rider ed è stata commissariata}. (2020, May 29). Il Post. http://www.ilpost.it/2020/05/29/uber\sphinxhyphen{}commissariamento\sphinxhyphen{}rider\sphinxhyphen{}sfruttamento\sphinxhyphen{}caporalato/

\sphinxAtStartPar
\sphinxstyleemphasis{Who we are \sphinxhyphen{} BikeMi}. (n.d.). Retrieved October 26, 2021, from https://bikemi.com/en/who\sphinxhyphen{}we\sphinxhyphen{}are

\sphinxAtStartPar
Yang, H., Huo, J., Bao, Y., Li, X., Yang, L., \& Cherry, C. R. (2021). Impact of e\sphinxhyphen{}scooter sharing on bike sharing in Chicago. \sphinxstyleemphasis{Transportation Research Part A: Policy and Practice}, \sphinxstyleemphasis{154}, 23–36. https://doi.org/10.1016/j.tra.2021.09.012

\sphinxAtStartPar
Zhu, R., Zhang, X., Kondor, D., Santi, P., \& Ratti, C. (2020). Understanding spatio\sphinxhyphen{}temporal heterogeneity of bike\sphinxhyphen{}sharing and scooter\sphinxhyphen{}sharing mobility. \sphinxstyleemphasis{Computers, Environment and Urban Systems}, \sphinxstyleemphasis{81}, 101483. https://doi.org/10.1016/j.compenvurbsys.2020.101483


\section{Chapter 3}
\label{\detokenize{references:chapter-3}}
\sphinxAtStartPar
\sphinxstyleemphasis{Gawk \sphinxhyphen{} GNU Project \sphinxhyphen{} Free Software Foundation (FSF)}. (n.d.). Retrieved October 23, 2021, from https://www.gnu.org/software/gawk/

\sphinxAtStartPar
Perkel, J. M. (2019). Julia: come for the syntax, stay for the speed. \sphinxstyleemphasis{Nature}, \sphinxstyleemphasis{572}(7767), 141–142. https://doi.org/10.1038/d41586\sphinxhyphen{}019\sphinxhyphen{}02310\sphinxhyphen{}3

\sphinxAtStartPar
Perkel, J. M. (2020). Why scientists are turning to Rust. \sphinxstyleemphasis{Nature}, \sphinxstyleemphasis{588}(7836), 185–186. https://doi.org/10.1038/d41586\sphinxhyphen{}020\sphinxhyphen{}03382\sphinxhyphen{}2

\sphinxAtStartPar
Saibene, G., \& Manzi, G. (2015). \sphinxstyleemphasis{Bike Usage in Public Bike\sphinxhyphen{}Sharing: An Analysis of the “BikeMi” System in Milan}. 21. https://air.unimi.it/handle/2434/515293


\section{Chapter 4}
\label{\detokenize{references:chapter-4}}
\sphinxAtStartPar
Ali, M., Alqahtani, A., Jones, M. W., \& Xie, X. (2019). Clustering and Classification for Time Series Data in Visual Analytics: A Survey. \sphinxstyleemphasis{IEEE Access}, \sphinxstyleemphasis{7}, 181314–181338. https://doi.org/10.1109/ACCESS.2019.2958551

\sphinxAtStartPar
Brenning, A. (2012). Spatial cross\sphinxhyphen{}validation and bootstrap for the assessment of prediction rules in remote sensing: The R package sperrorest. \sphinxstyleemphasis{2012 IEEE International Geoscience and Remote Sensing Symposium}, 5372–5375. https://doi.org/10.1109/IGARSS.2012.6352393

\sphinxAtStartPar
Cantelmo, G., Kucharski, R., \& Antoniou, C. (2020). Low\sphinxhyphen{}Dimensional Model for Bike\sphinxhyphen{}Sharing Demand Forecasting that Explicitly Accounts for Weather Data. \sphinxstyleemphasis{Transportation Research Record}, \sphinxstyleemphasis{2674}(8), 132–144. https://doi.org/10.1177/0361198120932160

\sphinxAtStartPar
Chen, L., Zhang, D., Wang, L., Yang, D., Ma, X., Li, S., Wu, Z., Pan, G., Nguyen, T.\sphinxhyphen{}M.\sphinxhyphen{}T., \& Jakubowicz, J. (2016). Dynamic cluster\sphinxhyphen{}based over\sphinxhyphen{}demand prediction in bike sharing systems. \sphinxstyleemphasis{Proceedings of the 2016 ACM International Joint Conference on Pervasive and Ubiquitous Computing}, 841–852. https://doi.org/10.1145/2971648.2971652

\sphinxAtStartPar
\sphinxstyleemphasis{Clustering}. (n.d.). Scikit\sphinxhyphen{}Learn. Retrieved November 8, 2021, from https://scikit\sphinxhyphen{}learn/stable/modules/clustering.html

\sphinxAtStartPar
Gower, J. C. (1971). A General Coefficient of Similarity and Some of Its Properties. \sphinxstyleemphasis{Biometrics}, \sphinxstyleemphasis{27}(4), 857–871. https://doi.org/10.2307/2528823

\sphinxAtStartPar
Huang, Z. (1998). Extensions to the k\sphinxhyphen{}Means Algorithm for Clustering Large Data Sets with Categorical Values. \sphinxstyleemphasis{Data Mining and Knowledge Discovery}, \sphinxstyleemphasis{2}(3), 283–304. https://doi.org/10.1023/A:1009769707641

\sphinxAtStartPar
Li, Y., Zhu, Z., \& Guo, X. (2019). Operating Characteristics of Dockless Bike\sphinxhyphen{}Sharing Systems near Metro Stations: Case Study in Nanjing City, China. \sphinxstyleemphasis{Sustainability}, \sphinxstyleemphasis{11}(8), 2256. https://doi.org/10.3390/su11082256

\sphinxAtStartPar
Ma, Y., Lan, J., Thornton, T., Mangalagiu, D., \& Zhu, D. (2018). Challenges of collaborative governance in the sharing economy: The case of free\sphinxhyphen{}floating bike sharing in Shanghai. \sphinxstyleemphasis{Journal of Cleaner Production}, \sphinxstyleemphasis{197}, 356–365. https://doi.org/10.1016/j.jclepro.2018.06.213

\sphinxAtStartPar
Roberts, D. R., Bahn, V., Ciuti, S., Boyce, M. S., Elith, J., Guillera\sphinxhyphen{}Arroita, G., Hauenstein, S., Lahoz\sphinxhyphen{}Monfort, J. J., Schröder, B., Thuiller, W., Warton, D. I., Wintle, B. A., Hartig, F., \& Dormann, C. F. (2017). Cross\sphinxhyphen{}validation strategies for data with temporal, spatial, hierarchical, or phylogenetic structure. \sphinxstyleemphasis{Ecography}, \sphinxstyleemphasis{40}(8), 913–929. https://doi.org/10.1111/ecog.02881

\sphinxAtStartPar
Sohil, F., Sohali, M. U., \& Shabbir, J. (2021). An introduction to statistical learning with applications in R: by Gareth James, Daniela Witten, Trevor Hastie, and Robert Tibshirani, New York, Springer Science and Business Media, 2013, \$41.98, eISBN: 978\sphinxhyphen{}1\sphinxhyphen{}4614\sphinxhyphen{}7137\sphinxhyphen{}7. \sphinxstyleemphasis{Statistical Theory and Related Fields}, 1–1. https://doi.org/10.1080/24754269.2021.1980261


\section{Chapter 5}
\label{\detokenize{references:chapter-5}}
\sphinxAtStartPar
Ai, Y., Li, Z., Gan, M., Zhang, Y., Yu, D., Chen, W., \& Ju, Y. (2019). A deep learning approach on short\sphinxhyphen{}term spatiotemporal distribution forecasting of dockless bike\sphinxhyphen{}sharing system. \sphinxstyleemphasis{Neural Computing and Applications}, \sphinxstyleemphasis{31}(5), 1665–1677. https://doi.org/10.1007/s00521\sphinxhyphen{}018\sphinxhyphen{}3470\sphinxhyphen{}9

\sphinxAtStartPar
An, R., Zahnow, R., Pojani, D., \& Corcoran, J. (2019). Weather and cycling in New York: The case of Citibike. \sphinxstyleemphasis{Journal of Transport Geography}, \sphinxstyleemphasis{77}, 97–112. https://doi.org/10.1016/j.jtrangeo.2019.04.016

\sphinxAtStartPar
Cantelmo, G., Kucharski, R., \& Antoniou, C. (2020). Low\sphinxhyphen{}Dimensional Model for Bike\sphinxhyphen{}Sharing Demand Forecasting that Explicitly Accounts for Weather Data. \sphinxstyleemphasis{Transportation Research Record}, \sphinxstyleemphasis{2674}(8), 132–144. https://doi.org/10.1177/0361198120932160

\sphinxAtStartPar
Chen, L., Zhang, D., Wang, L., Yang, D., Ma, X., Li, S., Wu, Z., Pan, G., Nguyen, T.\sphinxhyphen{}M.\sphinxhyphen{}T., \& Jakubowicz, J. (2016). Dynamic cluster\sphinxhyphen{}based over\sphinxhyphen{}demand prediction in bike sharing systems. \sphinxstyleemphasis{Proceedings of the 2016 ACM International Joint Conference on Pervasive and Ubiquitous Computing}, 841–852. https://doi.org/10.1145/2971648.2971652

\sphinxAtStartPar
Cleveland, W. S., \& Devlin, S. J. (1988). Locally Weighted Regression: An Approach to Regression Analysis by Local Fitting. \sphinxstyleemphasis{Journal of the American Statistical Association}, \sphinxstyleemphasis{83}(403), 596–610. https://doi.org/10.1080/01621459.1988.10478639

\sphinxAtStartPar
Dickey, D. A., \& Fuller, W. A. (2012). Distribution of the Estimators for Autoregressive Time Series with a Unit Root. \sphinxstyleemphasis{Journal of the American Statistical Association}. https://www.tandfonline.com/doi/abs/10.1080/01621459.1979.10482531

\sphinxAtStartPar
Hamad, S. Y. Y., Ma, T., \& Antoniou, C. (2021). Analysis and Prediction of Bikesharing Traffic Flow – Citi Bike, New York. \sphinxstyleemphasis{2021 7th International Conference on Models and Technologies for Intelligent Transportation Systems (MT\sphinxhyphen{}ITS)}, 1–8. https://doi.org/10.1109/MT\sphinxhyphen{}ITS49943.2021.9529290

\sphinxAtStartPar
Heinen, E., Maat, K., \& van Wee, B. (2011). Day\sphinxhyphen{}to\sphinxhyphen{}Day Choice to Commute or Not by Bicycle. \sphinxstyleemphasis{Transportation Research Record}, \sphinxstyleemphasis{2230}(1), 9–18. https://doi.org/10.3141/2230\sphinxhyphen{}02

\sphinxAtStartPar
Hyndman, R., \& Athanasopoulos, G. (2021). \sphinxstyleemphasis{Forecasting: Principles and Practice}. https://research.monash.edu/en/publications/forecasting\sphinxhyphen{}principles\sphinxhyphen{}and\sphinxhyphen{}practice\sphinxhyphen{}3

\sphinxAtStartPar
Kwiatkowski, D., Phillips, P. C. B., Schmidt, P., \& Shin, Y. (1992). Testing the null hypothesis of stationarity against the alternative of a unit root: How sure are we that economic time series have a unit root? \sphinxstyleemphasis{Journal of Econometrics}, \sphinxstyleemphasis{54}(1), 159–178. https://doi.org/10.1016/0304\sphinxhyphen{}4076(92)90104\sphinxhyphen{}Y

\sphinxAtStartPar
Salaken, S. M., Hosen, M. A., Khosravi, A., \& Nahavandi, S. (2015). Forecasting Bike Sharing Demand Using Fuzzy Inference Mechanism. In S. Arik, T. Huang, W. K. Lai, \& Q. Liu (Eds.), \sphinxstyleemphasis{Neural Information Processing} (pp. 567–574). Springer International Publishing. https://doi.org/10.1007/978\sphinxhyphen{}3\sphinxhyphen{}319\sphinxhyphen{}26555\sphinxhyphen{}1\_64

\sphinxAtStartPar
Seabold, S., \& Perktold, J. (2010). statsmodels: Econometric and statistical modeling with python. \sphinxstyleemphasis{9th Python in Science Conference}.

\sphinxAtStartPar
Thomas, T., Jaarsma, R., \& Tutert, B. (2013). Exploring temporal fluctuations of daily cycling demand on Dutch cycle paths: the influence of weather on cycling. \sphinxstyleemphasis{Transportation}, \sphinxstyleemphasis{40}(1), 1–22. https://doi.org/10.1007/s11116\sphinxhyphen{}012\sphinxhyphen{}9398\sphinxhyphen{}5

\sphinxAtStartPar
Xu, C., Ji, J., \& Liu, P. (2018). The station\sphinxhyphen{}free sharing bike demand forecasting with a deep learning approach and large\sphinxhyphen{}scale datasets. \sphinxstyleemphasis{Transportation Research Part C: Emerging Technologies}, \sphinxstyleemphasis{95}, 47–60. https://doi.org/10.1016/j.trc.2018.07.013


\section{Chapter 6}
\label{\detokenize{references:chapter-6}}

\section{Chapter 7}
\label{\detokenize{references:chapter-7}}






\renewcommand{\indexname}{Index}
\printindex
\end{document}